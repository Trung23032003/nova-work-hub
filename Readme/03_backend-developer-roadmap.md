# Lá»™ trÃ¬nh Backend Developer cho Fresher

> **Má»¥c tiÃªu**: TÃ i liá»‡u nÃ y cung cáº¥p lá»™ trÃ¬nh há»c táº­p chi tiáº¿t vÃ  cÃ¡c kiáº¿n thá»©c cá»‘t lÃµi mÃ  má»™t Backend Developer fresher cáº§n náº¯m vá»¯ng Ä‘á»ƒ lÃ m viá»‡c hiá»‡u quáº£ trong dá»± Ã¡n NovaWork Hub.

---

## ğŸ“‹ Má»¥c lá»¥c

1. [Tá»•ng quan vá» Backend Development](#1-tá»•ng-quan-vá»-backend-development)
2. [Kiáº¿n thá»©c ná»n táº£ng báº¯t buá»™c](#2-kiáº¿n-thá»©c-ná»n-táº£ng-báº¯t-buá»™c)
3. [Kiáº¿n thá»©c chuyÃªn sÃ¢u cho dá»± Ã¡n](#3-kiáº¿n-thá»©c-chuyÃªn-sÃ¢u-cho-dá»±-Ã¡n)
4. [TÃ i nguyÃªn há»c táº­p](#4-tÃ i-nguyÃªn-há»c-táº­p)

---

## 1. Tá»•ng quan vá» Backend Development

### Backend Developer lÃ m gÃ¬?

Backend Developer chá»‹u trÃ¡ch nhiá»‡m xÃ¢y dá»±ng vÃ  duy trÃ¬ **pháº§n "sau háº­u trÆ°á»ng"** cá»§a á»©ng dá»¥ng:

| Nhiá»‡m vá»¥ | MÃ´ táº£ |
|----------|-------|
| **Xá»­ lÃ½ Logic nghiá»‡p vá»¥** | Viáº¿t code xá»­ lÃ½ cÃ¡c yÃªu cáº§u tá»« client (táº¡o user, xá»­ lÃ½ Ä‘Æ¡n hÃ ng, tÃ­nh toÃ¡n...) |
| **Quáº£n lÃ½ Database** | Thiáº¿t káº¿, truy váº¥n, vÃ  tá»‘i Æ°u cÆ¡ sá»Ÿ dá»¯ liá»‡u |
| **XÃ¡c thá»±c & PhÃ¢n quyá»n** | Äáº£m báº£o chá»‰ ngÆ°á»i dÃ¹ng há»£p lá»‡ má»›i truy cáº­p Ä‘Æ°á»£c tÃ i nguyÃªn |
| **XÃ¢y dá»±ng API** | Táº¡o cÃ¡c endpoint Ä‘á»ƒ Frontend giao tiáº¿p vá»›i Backend |
| **Báº£o máº­t** | Báº£o vá»‡ dá»¯ liá»‡u vÃ  ngÄƒn cháº·n cÃ¡c cuá»™c táº¥n cÃ´ng |

### Stack cÃ´ng nghá»‡ trong dá»± Ã¡n NovaWork Hub

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND                              â”‚
â”‚              Next.js 15 (React + TypeScript)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Server Actions / API Routes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Auth.js v5  â”‚  â”‚ Server Logic â”‚  â”‚  Zod Validation â”‚   â”‚
â”‚   â”‚ (XÃ¡c thá»±c)  â”‚  â”‚ (Nghiá»‡p vá»¥)  â”‚  â”‚  (Kiá»ƒm tra DL)  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Prisma ORM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATABASE                               â”‚
â”‚                PostgreSQL (Supabase)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Kiáº¿n thá»©c ná»n táº£ng báº¯t buá»™c

### 2.1. TypeScript (â­â­â­â­â­ Quan trá»ng nháº¥t)

TypeScript lÃ  ngÃ´n ngá»¯ chÃ­nh cá»§a dá»± Ã¡n. Báº¡n **PHáº¢I** náº¯m vá»¯ng trÆ°á»›c khi há»c cÃ¡c pháº§n khÃ¡c.

> ğŸ’¡ **Táº¡i sao TypeScript quan trá»ng?** TypeScript bá»• sung **type annotations** (chÃº thÃ­ch kiá»ƒu) vÃ o JavaScript Ä‘á»ƒ giÃºp báº¡n phÃ¡t hiá»‡n lá»—i **trÆ°á»›c khi cháº¡y code**, khÃ´ng pháº£i lÃºc production Ä‘ang cháº¡y!

---

#### 2.1.1. Basic Types - CÃ¡c kiá»ƒu dá»¯ liá»‡u cÆ¡ báº£n

```typescript
// âŒ JavaScript thuáº§n - khÃ´ng biáº¿t biáº¿n nÃ y chá»©a gÃ¬
let name = "Trung";
name = 123; // JavaScript cho phÃ©p, nhÆ°ng Ä‘Ã¢y lÃ  bug tiá»m áº©n!

// âœ… TypeScript - khai bÃ¡o rÃµ rÃ ng kiá»ƒu dá»¯ liá»‡u
let name: string = "Trung";
name = 123; // âŒ Lá»–I! TypeScript bÃ¡o ngay: Type 'number' is not assignable to type 'string'
```

**CÃ¡c kiá»ƒu cÆ¡ báº£n báº¡n sáº½ dÃ¹ng hÃ ng ngÃ y:**

| Kiá»ƒu | MÃ´ táº£ | VÃ­ dá»¥ |
|------|-------|-------|
| `string` | Chuá»—i vÄƒn báº£n | `"Hello"`, `'World'`, `` `Template` `` |
| `number` | Sá»‘ (integer + float) | `42`, `3.14`, `-100` |
| `boolean` | ÄÃºng/Sai | `true`, `false` |
| `null` | GiÃ¡ trá»‹ rá»—ng cÃ³ chá»§ Ä‘Ã­ch | `null` |
| `undefined` | ChÆ°a Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹ | `undefined` |
| `any` | Báº¥t ká»³ kiá»ƒu nÃ o (âš ï¸ **trÃ¡nh dÃ¹ng**) | Má»i thá»© |

```typescript
// Khai bÃ¡o biáº¿n vá»›i type
let userName: string = "Trung";
let userAge: number = 22;
let isActive: boolean = true;
let avatar: string | null = null; // cÃ³ thá»ƒ lÃ  string HOáº¶C null

// Array - Máº£ng
let scores: number[] = [85, 90, 78];
let names: string[] = ["An", "BÃ¬nh", "ChÃ¢u"];

// CÃ¡ch viáº¿t khÃ¡c cho array (Generic syntax)
let scores2: Array<number> = [85, 90, 78];
```

---

#### 2.1.2. Interface - Äá»‹nh nghÄ©a "hÃ¬nh dáº¡ng" cá»§a Object

**Interface** giá»‘ng nhÆ° má»™t "báº£n thiáº¿t káº¿" mÃ´ táº£ object pháº£i cÃ³ nhá»¯ng thuá»™c tÃ­nh gÃ¬.

**Táº¡i sao cáº§n Interface?**

```typescript
// âŒ KhÃ´ng dÃ¹ng interface - dá»… sai sÃ³t
function createUser(user) {
  // KhÃ´ng biáº¿t user cÃ³ nhá»¯ng field gÃ¬
  // Dá»… gÃµ sai tÃªn field mÃ  khÃ´ng biáº¿t
  console.log(user.nmae); // GÃµ sai "name" thÃ nh "nmae" - khÃ´ng cÃ³ lá»—i!
}

// âœ… DÃ¹ng interface - an toÃ n hÆ¡n nhiá»u
interface User {
  id: string;
  name: string;
  email: string;
}

function createUser(user: User) {
  console.log(user.nmae); // âŒ Lá»–I NGAY! Property 'nmae' does not exist on type 'User'
  console.log(user.name); // âœ… OK
}
```

**CÃ¡ch viáº¿t Interface:**

```typescript
// Interface cÆ¡ báº£n
interface User {
  id: string;
  name: string;
  email: string;
}

// Optional property - dÃ¹ng dáº¥u ? (cÃ³ thá»ƒ cÃ³ hoáº·c khÃ´ng)
interface User {
  id: string;
  name: string;
  email: string;
  avatar?: string;  // avatar cÃ³ thá»ƒ cÃ³ hoáº·c khÃ´ng
  bio?: string;     // bio cÅ©ng optional
}

// Readonly property - khÃ´ng thá»ƒ thay Ä‘á»•i sau khi táº¡o
interface User {
  readonly id: string; // KhÃ´ng thá»ƒ gÃ¡n láº¡i id
  name: string;
  email: string;
}

const user: User = { id: "123", name: "Trung", email: "trung@email.com" };
user.id = "456";              // âŒ Lá»–I! Cannot assign to 'id' because it is a read-only property
user.name = "Trung Updated";  // âœ… OK, name khÃ´ng readonly
```

**Nested Interface (Interface lá»“ng nhau):**

```typescript
// Äá»‹a chá»‰ lÃ  má»™t object riÃªng
interface Address {
  street: string;
  city: string;
  country: string;
}

// User cÃ³ chá»©a Address
interface User {
  id: string;
  name: string;
  email: string;
  address: Address; // Nested interface
}

// Sá»­ dá»¥ng
const user: User = {
  id: "1",
  name: "Trung",
  email: "trung@email.com",
  address: {
    street: "123 Nguyá»…n Huá»‡",
    city: "TP.HCM",
    country: "Viá»‡t Nam",
  },
};
```

---

#### 2.1.3. Type Aliases - Äáº·t tÃªn cho kiá»ƒu dá»¯ liá»‡u

**Type** giá»‘ng interface nhÆ°ng linh hoáº¡t hÆ¡n, cÃ³ thá»ƒ Ä‘áº·t tÃªn cho báº¥t ká»³ kiá»ƒu nÃ o.

```typescript
// Type cho giÃ¡ trá»‹ Ä‘Æ¡n giáº£n
type UserId = string;
type Age = number;

// Type cho Union (nhiá»u lá»±a chá»n) - Ráº¤T HAY DÃ™NG!
type UserRole = "ADMIN" | "PM" | "MEMBER";
type Status = "pending" | "approved" | "rejected";

// Sá»­ dá»¥ng
let myRole: UserRole = "ADMIN";     // âœ… OK
myRole = "SUPER_ADMIN";             // âŒ Lá»–I! Type '"SUPER_ADMIN"' is not assignable to type 'UserRole'

// Type cho Object (giá»‘ng interface)
type User = {
  id: UserId;       // DÃ¹ng type alias khÃ¡c
  name: string;
  role: UserRole;   // DÃ¹ng union type
};
```

**Interface vs Type - Khi nÃ o dÃ¹ng cÃ¡i nÃ o?**

| TÃ¬nh huá»‘ng | DÃ¹ng | LÃ½ do |
|------------|------|-------|
| Äá»‹nh nghÄ©a object shape | `interface` | Dá»… extend, convention phá»• biáº¿n |
| Union types (`"A" \| "B" \| "C"`) | `type` | Interface khÃ´ng há»— trá»£ |
| Primitive alias (`type ID = string`) | `type` | Interface khÃ´ng há»— trá»£ |
| Extend/má»Ÿ rá»™ng | Cáº£ hai Ä‘á»u Ä‘Æ°á»£c | - |

```typescript
// Extend Interface
interface Animal {
  name: string;
}
interface Dog extends Animal {
  breed: string;
}

// Extend Type (dÃ¹ng &)
type Animal = {
  name: string;
};
type Dog = Animal & {
  breed: string;
};
```

---

#### 2.1.4. Generics - "Template" cho Types

**Generics** cho phÃ©p báº¡n viáº¿t code **tÃ¡i sá»­ dá»¥ng** vá»›i nhiá»u kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau. ÄÃ¢y lÃ  khÃ¡i niá»‡m **Ráº¤T QUAN TRá»ŒNG** vÃ¬ Prisma sá»­ dá»¥ng Generics ráº¥t nhiá»u.

**Váº¥n Ä‘á» khÃ´ng cÃ³ Generics:**

```typescript
// âŒ Pháº£i viáº¿t nhiá»u hÃ m cho tá»«ng kiá»ƒu - láº·p láº¡i code!
function getFirstNumber(arr: number[]): number | undefined {
  return arr[0];
}

function getFirstString(arr: string[]): string | undefined {
  return arr[0];
}

function getFirstUser(arr: User[]): User | undefined {
  return arr[0];
}

// ğŸ˜¤ Logic giá»‘ng nhau mÃ  pháº£i viáº¿t 3 láº§n!
```

**Giáº£i phÃ¡p vá»›i Generics:**

```typescript
// âœ… Má»™t hÃ m duy nháº¥t, hoáº¡t Ä‘á»™ng vá»›i Má»ŒI kiá»ƒu
function getFirst<T>(arr: T[]): T | undefined {
  return arr[0];
}

// T lÃ  "placeholder" - sáº½ Ä‘Æ°á»£c thay tháº¿ khi gá»i hÃ m

// Sá»­ dá»¥ng - chá»‰ Ä‘á»‹nh T lÃ  gÃ¬
const firstNumber = getFirst<number>([1, 2, 3]);     // T = number â†’ tráº£ vá» number | undefined
const firstString = getFirst<string>(["a", "b"]);   // T = string â†’ tráº£ vá» string | undefined
const firstUser = getFirst<User>(users);            // T = User â†’ tráº£ vá» User | undefined

// TypeScript tá»± suy luáº­n kiá»ƒu (khÃ´ng cáº§n viáº¿t <number>)
const firstNumber2 = getFirst([1, 2, 3]); // TypeScript tá»± hiá»ƒu T = number
```

**Generics trong thá»±c táº¿ - Prisma:**

```typescript
// Prisma dÃ¹ng Generics ráº¥t nhiá»u!
// Khi báº¡n viáº¿t:
const user = await prisma.user.findUnique({
  where: { id: "123" },
});
// â†’ TypeScript tá»± biáº¿t `user` cÃ³ kiá»ƒu `User | null`

// Vá»›i include:
const userWithProjects = await prisma.user.findUnique({
  where: { id: "123" },
  include: { projects: true },
});
// â†’ TypeScript tá»± biáº¿t `userWithProjects` cÃ³ cáº£ `projects` array!
// â†’ ÄÃ¢y lÃ  sá»©c máº¡nh cá»§a Generics!
```

**Generic vá»›i Constraints (giá»›i háº¡n):**

```typescript
// T pháº£i cÃ³ property "id" - náº¿u khÃ´ng sáº½ bÃ¡o lá»—i
function getItemById<T extends { id: string }>(items: T[], id: string): T | undefined {
  return items.find((item) => item.id === id);
}

// Hoáº¡t Ä‘á»™ng vá»›i báº¥t ká»³ object nÃ o cÃ³ "id"
interface User { id: string; name: string; }
interface Product { id: string; price: number; }

const user = getItemById(users, "user-1");       // âœ… OK - User cÃ³ id
const product = getItemById(products, "prod-1"); // âœ… OK - Product cÃ³ id
const number = getItemById([1, 2, 3], "1");      // âŒ Lá»–I! number khÃ´ng cÃ³ property "id"
```

---

#### 2.1.5. Utility Types - "CÃ´ng cá»¥" biáº¿n Ä‘á»•i Types

TypeScript cung cáº¥p sáºµn cÃ¡c utility types giÃºp báº¡n táº¡o types má»›i tá»« types cÃ³ sáºµn. ÄÃ¢y lÃ  nhá»¯ng "cÃ´ng cá»¥" báº¡n sáº½ dÃ¹ng **HÃ€NG NGÃ€Y**.

**`Partial<T>` - Táº¥t cáº£ fields thÃ nh optional**

```typescript
interface User {
  id: string;
  name: string;
  email: string;
  role: string;
}

// Khi UPDATE, khÃ´ng cáº§n gá»­i táº¥t cáº£ fields
type UpdateUserInput = Partial<User>;
// â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:
// {
//   id?: string;
//   name?: string;
//   email?: string;
//   role?: string;
// }

function updateUser(id: string, data: Partial<User>) {
  // Chá»‰ cáº§n gá»­i nhá»¯ng field muá»‘n update
}

updateUser("123", { name: "New Name" }); // âœ… OK, chá»‰ update name
updateUser("123", { role: "ADMIN" });    // âœ… OK, chá»‰ update role
```

**`Omit<T, Keys>` - Bá» Ä‘i má»™t sá»‘ fields**

```typescript
interface User {
  id: string;
  name: string;
  email: string;
  password: string;  // âš ï¸ KhÃ´ng muá»‘n tráº£ vá» password!
  createdAt: Date;
}

// Type cho response - khÃ´ng cÃ³ password
type UserResponse = Omit<User, "password">;
// â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
// {
//   id: string;
//   name: string;
//   email: string;
//   createdAt: Date;
// }

// Type khÃ´ng cÃ³ id vÃ  timestamps (dÃ¹ng khi CREATE)
type CreateUserInput = Omit<User, "id" | "createdAt">;
```

**`Pick<T, Keys>` - Chá»‰ láº¥y má»™t sá»‘ fields**

```typescript
interface User {
  id: string;
  name: string;
  email: string;
  password: string;
  role: string;
  avatar: string;
  bio: string;
  createdAt: Date;
}

// Chá»‰ cáº§n email vÃ  password cho login
type LoginCredentials = Pick<User, "email" | "password">;
// â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
// {
//   email: string;
//   password: string;
// }

// Profile preview chá»‰ cáº§n má»™t sá»‘ thÃ´ng tin
type UserPreview = Pick<User, "id" | "name" | "avatar">;
```

**`Required<T>` - Táº¥t cáº£ fields thÃ nh báº¯t buá»™c**

```typescript
interface Config {
  apiUrl?: string;
  timeout?: number;
  retries?: number;
}

// Äáº£m báº£o táº¥t cáº£ config Ä‘á»u Ä‘Æ°á»£c set
type FullConfig = Required<Config>;
// â†’ Táº¥t cáº£ fields khÃ´ng cÃ²n optional
```

---

#### 2.1.6. Union Types & Type Guards

**Union Types - "Hoáº·c nÃ y, hoáº·c kia"**

```typescript
// Biáº¿n cÃ³ thá»ƒ lÃ  string HOáº¶C number
let id: string | number;
id = "abc";   // âœ… OK
id = 123;     // âœ… OK
id = true;    // âŒ Lá»–I!

// Pattern ráº¥t phá»• biáº¿n cho API response
type Result<T> = 
  | { success: true; data: T }
  | { success: false; error: string };

function fetchUser(id: string): Result<User> {
  try {
    // ... fetch user
    return { success: true, data: user };
  } catch (err) {
    return { success: false, error: "User not found" };
  }
}

// Xá»­ lÃ½ káº¿t quáº£ - TypeScript hiá»ƒu tá»«ng case!
const result = fetchUser("123");
if (result.success) {
  // TypeScript biáº¿t result.data tá»“n táº¡i vÃ  cÃ³ kiá»ƒu User
  console.log(result.data.name);
} else {
  // TypeScript biáº¿t result.error tá»“n táº¡i
  console.log(result.error);
}
```

**Type Guards - Kiá»ƒm tra kiá»ƒu táº¡i runtime**

```typescript
// typeof guard - kiá»ƒm tra kiá»ƒu primitive
function process(value: string | number) {
  if (typeof value === "string") {
    // â†’ TypeScript biáº¿t value lÃ  string á»Ÿ Ä‘Ã¢y
    console.log(value.toUpperCase());
  } else {
    // â†’ TypeScript biáº¿t value lÃ  number á»Ÿ Ä‘Ã¢y
    console.log(value.toFixed(2));
  }
}

// "in" guard - kiá»ƒm tra property cÃ³ tá»“n táº¡i khÃ´ng
interface Dog {
  bark(): void;
}

interface Cat {
  meow(): void;
}

function makeSound(animal: Dog | Cat) {
  if ("bark" in animal) {
    animal.bark(); // â†’ TypeScript biáº¿t lÃ  Dog
  } else {
    animal.meow(); // â†’ TypeScript biáº¿t lÃ  Cat
  }
}
```

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh TypeScript

Äá»ƒ náº¯m vá»¯ng cÃ¡c khÃ¡i niá»‡m trÃªn, hÃ£y thá»­ lÃ m cÃ¡c bÃ i táº­p sau:

**BÃ i 1: Táº¡o Interface cho Task Management**
```typescript
// TODO: Táº¡o interface Task vá»›i cÃ¡c fields:
// - id: string (readonly)
// - title: string
// - description: string (optional)
// - status: "TODO" | "IN_PROGRESS" | "DONE"
// - priority: "LOW" | "MEDIUM" | "HIGH"
// - assigneeId: string (optional)
// - createdAt: Date
// - updatedAt: Date
```

**BÃ i 2: Viáº¿t Generic Function**
```typescript
// TODO: Viáº¿t hÃ m findById<T> tÃ¬m item trong array theo id
// Hint: T pháº£i cÃ³ property "id"
```

**BÃ i 3: DÃ¹ng Utility Types**
```typescript
// TODO: Tá»« interface Task á»Ÿ BÃ i 1, táº¡o:
// - CreateTaskInput (khÃ´ng cÃ³ id, createdAt, updatedAt)
// - UpdateTaskInput (táº¥t cáº£ optional trá»« id)
// - TaskPreview (chá»‰ cÃ³ id, title, status)
```

---

#### ğŸ“— Lá»i giáº£i bÃ i táº­p

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 1</strong></summary>

```typescript
// BÆ°á»›c 1: Äá»‹nh nghÄ©a cÃ¡c Union Types cho status vÃ  priority
type TaskStatus = "TODO" | "IN_PROGRESS" | "DONE";
type TaskPriority = "LOW" | "MEDIUM" | "HIGH";

// BÆ°á»›c 2: Táº¡o interface Task
interface Task {
  readonly id: string;        // readonly - khÃ´ng thá»ƒ thay Ä‘á»•i sau khi táº¡o
  title: string;
  description?: string;       // optional - cÃ³ dáº¥u ?
  status: TaskStatus;         // dÃ¹ng union type Ä‘Ã£ Ä‘á»‹nh nghÄ©a
  priority: TaskPriority;
  assigneeId?: string;        // optional
  createdAt: Date;
  updatedAt: Date;
}

// VÃ­ dá»¥ sá»­ dá»¥ng:
const task: Task = {
  id: "task-001",
  title: "Há»c TypeScript",
  status: "IN_PROGRESS",
  priority: "HIGH",
  createdAt: new Date(),
  updatedAt: new Date(),
  // description vÃ  assigneeId khÃ´ng báº¯t buá»™c
};

// âŒ Lá»—i vÃ¬ id lÃ  readonly
task.id = "new-id"; // Cannot assign to 'id' because it is a read-only property

// âŒ Lá»—i vÃ¬ status khÃ´ng há»£p lá»‡
const badTask: Task = {
  ...task,
  status: "PENDING", // Type '"PENDING"' is not assignable to type 'TaskStatus'
};
```

**Giáº£i thÃ­ch:**
- `readonly` Ä‘áº£m báº£o `id` khÃ´ng bá»‹ thay Ä‘á»•i sau khi task Ä‘Æ°á»£c táº¡o
- `?` cho phÃ©p field lÃ  optional (cÃ³ thá»ƒ khÃ´ng truyá»n)
- Union types (`"TODO" | "IN_PROGRESS" | "DONE"`) giá»›i háº¡n giÃ¡ trá»‹ há»£p lá»‡

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 2</strong></summary>

```typescript
// CÃ¡ch 1: Generic vá»›i constraint inline
function findById<T extends { id: string }>(
  items: T[], 
  id: string
): T | undefined {
  return items.find((item) => item.id === id);
}

// CÃ¡ch 2: Äá»‹nh nghÄ©a interface riÃªng cho constraint (dá»… tÃ¡i sá»­ dá»¥ng)
interface HasId {
  id: string;
}

function findById<T extends HasId>(items: T[], id: string): T | undefined {
  return items.find((item) => item.id === id);
}

// VÃ­ dá»¥ sá»­ dá»¥ng:
interface User {
  id: string;
  name: string;
  email: string;
}

interface Product {
  id: string;
  name: string;
  price: number;
}

const users: User[] = [
  { id: "u1", name: "Trung", email: "trung@mail.com" },
  { id: "u2", name: "An", email: "an@mail.com" },
];

const products: Product[] = [
  { id: "p1", name: "Laptop", price: 1000 },
  { id: "p2", name: "Mouse", price: 50 },
];

// âœ… Hoáº¡t Ä‘á»™ng vá»›i User
const user = findById(users, "u1");
// TypeScript biáº¿t user cÃ³ kiá»ƒu User | undefined
console.log(user?.name); // "Trung"

// âœ… Hoáº¡t Ä‘á»™ng vá»›i Product
const product = findById(products, "p2");
// TypeScript biáº¿t product cÃ³ kiá»ƒu Product | undefined
console.log(product?.price); // 50

// âŒ Lá»—i vá»›i array khÃ´ng cÃ³ id
const numbers = [1, 2, 3];
findById(numbers, "1"); 
// Error: Type 'number' does not satisfy the constraint '{ id: string }'
```

**Giáº£i thÃ­ch:**
- `T extends { id: string }` yÃªu cáº§u T pháº£i cÃ³ property `id` kiá»ƒu string
- HÃ m tráº£ vá» `T | undefined` vÃ¬ cÃ³ thá»ƒ khÃ´ng tÃ¬m tháº¥y
- TypeScript tá»± Ä‘á»™ng suy luáº­n kiá»ƒu T dá»±a vÃ o argument truyá»n vÃ o

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 3</strong></summary>

```typescript
// Interface Task tá»« BÃ i 1
type TaskStatus = "TODO" | "IN_PROGRESS" | "DONE";
type TaskPriority = "LOW" | "MEDIUM" | "HIGH";

interface Task {
  readonly id: string;
  title: string;
  description?: string;
  status: TaskStatus;
  priority: TaskPriority;
  assigneeId?: string;
  createdAt: Date;
  updatedAt: Date;
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// CreateTaskInput: KhÃ´ng cÃ³ id, createdAt, updatedAt
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
type CreateTaskInput = Omit<Task, "id" | "createdAt" | "updatedAt">;

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:
// {
//   title: string;
//   description?: string;
//   status: TaskStatus;
//   priority: TaskPriority;
//   assigneeId?: string;
// }

// VÃ­ dá»¥ sá»­ dá»¥ng:
const newTask: CreateTaskInput = {
  title: "HoÃ n thÃ nh bÃ¡o cÃ¡o",
  status: "TODO",
  priority: "HIGH",
  // KhÃ´ng cáº§n id, createdAt, updatedAt - server sáº½ tá»± táº¡o
};

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// UpdateTaskInput: Táº¥t cáº£ optional, nhÆ°ng pháº£i cÃ³ id
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
type UpdateTaskInput = Partial<Omit<Task, "id" | "createdAt">> & {
  id: string; // id báº¯t buá»™c
};

// CÃ¡ch khÃ¡c dÃ¹ng Pick + Partial:
type UpdateTaskInput2 = Pick<Task, "id"> & 
  Partial<Omit<Task, "id" | "createdAt" | "updatedAt">>;

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:
// {
//   id: string;           // báº¯t buá»™c
//   title?: string;       // optional
//   description?: string; // optional
//   status?: TaskStatus;  // optional
//   priority?: TaskPriority; // optional
//   assigneeId?: string;  // optional
//   updatedAt?: Date;     // optional
// }

// VÃ­ dá»¥ sá»­ dá»¥ng:
const updateData: UpdateTaskInput = {
  id: "task-001",         // báº¯t buá»™c - Ä‘á»ƒ biáº¿t update task nÃ o
  status: "DONE",         // chá»‰ update status
  // CÃ¡c field khÃ¡c khÃ´ng cáº§n
};

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// TaskPreview: Chá»‰ cÃ³ id, title, status
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
type TaskPreview = Pick<Task, "id" | "title" | "status">;

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:
// {
//   id: string;        // readonly bá»‹ máº¥t khi dÃ¹ng Pick
//   title: string;
//   status: TaskStatus;
// }

// VÃ­ dá»¥ sá»­ dá»¥ng - hiá»ƒn thá»‹ danh sÃ¡ch task:
const taskList: TaskPreview[] = [
  { id: "t1", title: "Task 1", status: "TODO" },
  { id: "t2", title: "Task 2", status: "IN_PROGRESS" },
  { id: "t3", title: "Task 3", status: "DONE" },
];

// Render danh sÃ¡ch - chá»‰ cáº§n 3 fields Ä‘á»ƒ hiá»ƒn thá»‹
taskList.forEach((task) => {
  console.log(`[${task.status}] ${task.title}`);
});
```

**Giáº£i thÃ­ch:**
- `Omit<T, K>`: Loáº¡i bá» cÃ¡c keys K khá»i type T
- `Partial<T>`: Biáº¿n táº¥t cáº£ fields thÃ nh optional
- `Pick<T, K>`: Chá»‰ láº¥y cÃ¡c keys K tá»« type T
- `A & B`: Intersection - káº¿t há»£p cáº£ A vÃ  B (pháº£i thá»a mÃ£n cáº£ hai)

**Khi nÃ o dÃ¹ng cÃ¡i nÃ o:**
| Use Case | Utility Type |
|----------|--------------|
| Táº¡o má»›i (CREATE) | `Omit` - loáº¡i bá» id, timestamps |
| Cáº­p nháº­t (UPDATE) | `Partial` + `Omit` - táº¥t cáº£ optional trá»« id |
| Xem danh sÃ¡ch | `Pick` - chá»‰ láº¥y fields cáº§n hiá»ƒn thá»‹ |

</details>

---

### 2.2. SQL & CÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡

**SQL (Structured Query Language)** lÃ  ngÃ´n ngá»¯ chuáº©n Ä‘á»ƒ lÃ m viá»‡c vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ (Relational Database). ÄÃ¢y lÃ  kiáº¿n thá»©c **ná»n táº£ng báº¯t buá»™c** cho má»i Backend Developer.

---

#### 2.2.1. CÃ¡c khÃ¡i niá»‡m cá»‘t lÃµi

| KhÃ¡i niá»‡m | MÃ´ táº£ | VÃ­ dá»¥ |
|-----------|-------|-------|
| **Table** | Báº£ng chá»©a dá»¯ liá»‡u | `users`, `projects`, `tasks` |
| **Column** | Cá»™t/thuá»™c tÃ­nh cá»§a báº£ng | `id`, `email`, `name` |
| **Row** | Má»™t báº£n ghi/record | Má»™t user cá»¥ thá»ƒ |
| **Primary Key (PK)** | KhÃ³a chÃ­nh, Ä‘á»‹nh danh duy nháº¥t | `id` |
| **Foreign Key (FK)** | KhÃ³a ngoáº¡i, liÃªn káº¿t báº£ng | `project_id` trong báº£ng `tasks` |
| **Index** | ÄÃ¡nh chá»‰ má»¥c Ä‘á»ƒ truy váº¥n nhanh | Index trÃªn `email` |

**ğŸ“Š Table (Báº£ng)**
- LÃ  nÆ¡i **lÆ°u trá»¯ dá»¯ liá»‡u** cÃ³ cáº¥u trÃºc
- Má»—i báº£ng Ä‘áº¡i diá»‡n cho má»™t **thá»±c thá»ƒ** (entity) trong há»‡ thá»‘ng
```
Báº£ng users     â†’ LÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng
Báº£ng projects  â†’ LÆ°u thÃ´ng tin dá»± Ã¡n
Báº£ng tasks     â†’ LÆ°u thÃ´ng tin cÃ´ng viá»‡c
```

**ğŸ“‹ Column (Cá»™t)**
- LÃ  **thuá»™c tÃ­nh/trÆ°á»ng dá»¯ liá»‡u** cá»§a báº£ng
- Má»—i column cÃ³ má»™t **kiá»ƒu dá»¯ liá»‡u** cá»¥ thá»ƒ (string, number, date, etc.)
```
Báº£ng users cÃ³ cÃ¡c columns:
â”œâ”€â”€ id       (string - Ä‘á»‹nh danh)
â”œâ”€â”€ email    (string - email)
â”œâ”€â”€ name     (string - tÃªn)
â””â”€â”€ role     (string - vai trÃ²)
```

**ğŸ“ Row (HÃ ng/Báº£n ghi)**
- LÃ  **má»™t record cá»¥ thá»ƒ** trong báº£ng
- Má»—i row chá»©a dá»¯ liá»‡u cho táº¥t cáº£ cÃ¡c columns
```
| id      | email           | name   | role   |
|---------|-----------------|--------|--------|
| u-001   | trung@mail.com  | Trung  | ADMIN  |  â† ÄÃ¢y lÃ  1 row
| u-002   | an@mail.com     | An     | MEMBER | â† ÄÃ¢y lÃ  1 row khÃ¡c
```

**ğŸ”‘ Primary Key (PK) - KhÃ³a chÃ­nh**
- LÃ  **Ä‘á»‹nh danh duy nháº¥t** cho má»—i row trong báº£ng
- **KhÃ´ng Ä‘Æ°á»£c trÃ¹ng láº·p** vÃ  **khÃ´ng Ä‘Æ°á»£c NULL**
- ThÆ°á»ng dÃ¹ng: `id`, `uuid`, `cuid`

```sql
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,  -- â† KhÃ³a chÃ­nh
  email VARCHAR(255),
  name VARCHAR(100)
);
```

**ğŸ”— Foreign Key (FK) - KhÃ³a ngoáº¡i**
- LÃ  **liÃªn káº¿t giá»¯a 2 báº£ng**
- FK trong báº£ng nÃ y **tham chiáº¿u Ä‘áº¿n PK** cá»§a báº£ng kia
- Äáº£m báº£o **tÃ­nh toÃ n váº¹n dá»¯ liá»‡u** (referential integrity)

```
Báº£ng tasks:
| id    | title        | project_id  |
|-------|--------------|-------------|
| t-001 | Code API     | p-001       | â† project_id lÃ  FK, tham chiáº¿u Ä‘áº¿n projects.id
| t-002 | Write docs   | p-001       |

Báº£ng projects:
| id    | title       |
|-------|-------------|
| p-001 | NovaWorkHub | â† PK cá»§a báº£ng projects
```

**ğŸ“‡ Index (Chá»‰ má»¥c)**
- **TÄƒng tá»‘c Ä‘á»™ truy váº¥n** dá»¯ liá»‡u
- Giá»‘ng nhÆ° má»¥c lá»¥c cá»§a sÃ¡ch - giÃºp tÃ¬m kiáº¿m nhanh hÆ¡n
- NÃªn Ä‘áº·t index trÃªn cÃ¡c columns **hay Ä‘Æ°á»£c tÃ¬m kiáº¿m/filter**

```sql
-- TÃ¬m user báº±ng email ráº¥t thÆ°á»ng xuyÃªn â†’ Táº¡o index
CREATE INDEX idx_users_email ON users(email);

-- Sau Ä‘Ã³ truy váº¥n nÃ y sáº½ nhanh hÆ¡n nhiá»u:
SELECT * FROM users WHERE email = 'trung@mail.com';
```

---

#### 2.2.2. CÃ¡c loáº¡i quan há»‡ (Relationships)

**ğŸ”¹ ONE-TO-ONE (1-1) - Má»™t-Má»™t**
```
User â”€â”€â”€â”€â”€â”€â”€â”€ Profile
```
- **Má»™t user** cÃ³ **Ä‘Ãºng má»™t profile**
- **Má»™t profile** thuá»™c vá» **Ä‘Ãºng má»™t user**
- **VÃ­ dá»¥ thá»±c táº¿:** Má»—i user cÃ³ 1 profile chá»©a thÃ´ng tin chi tiáº¿t (bio, avatar, social links...)

```sql
-- Báº£ng users
CREATE TABLE users (
  id VARCHAR(36) PRIMARY KEY,
  email VARCHAR(255) UNIQUE
);

-- Báº£ng profiles (FK user_id lÃ  UNIQUE Ä‘á»ƒ Ä‘áº£m báº£o 1-1)
CREATE TABLE profiles (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) UNIQUE,  -- â† UNIQUE Ä‘áº£m báº£o 1-1
  bio TEXT,
  avatar VARCHAR(500),
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**ğŸ”¹ ONE-TO-MANY (1-n) - Má»™t-Nhiá»u**
```
Project â”€â”€â”€â”€â”€â”€< Tasks
```
- **Má»™t project** cÃ³ **nhiá»u tasks**
- **Má»™t task** thuá»™c vá» **Ä‘Ãºng má»™t project**
- **Quan há»‡ phá»• biáº¿n nháº¥t** trong thá»±c táº¿

```sql
-- Báº£ng projects
CREATE TABLE projects (
  id VARCHAR(36) PRIMARY KEY,
  title VARCHAR(255)
);

-- Báº£ng tasks (FK project_id khÃ´ng cáº§n UNIQUE)
CREATE TABLE tasks (
  id VARCHAR(36) PRIMARY KEY,
  title VARCHAR(255),
  project_id VARCHAR(36),  -- â† Nhiá»u tasks cÃ³ thá»ƒ cÃ¹ng project_id
  FOREIGN KEY (project_id) REFERENCES projects(id)
);
```

**ğŸ”¹ MANY-TO-MANY (n-n) - Nhiá»u-Nhiá»u**
```
Users >â”€â”€â”€â”€â”€â”€â”€â”€< Projects
```
- **Má»™t user** tham gia **nhiá»u projects**
- **Má»™t project** cÃ³ **nhiá»u users**
- Cáº§n **báº£ng trung gian** (junction table) Ä‘á»ƒ liÃªn káº¿t

```sql
-- Báº£ng trung gian project_members
CREATE TABLE project_members (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36),
  project_id VARCHAR(36),
  role VARCHAR(50),  -- CÃ³ thá»ƒ thÃªm thÃ´ng tin vá» quan há»‡
  joined_at TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (project_id) REFERENCES projects(id),
  
  -- Äáº£m báº£o 1 user chá»‰ join 1 project 1 láº§n
  UNIQUE (user_id, project_id)
);
```

---

#### 2.2.3. CÃ¡c cÃ¢u lá»‡nh SQL cÆ¡ báº£n (CRUD)

**ğŸ“– SELECT - Láº¥y dá»¯ liá»‡u (Read)**

```sql
-- Láº¥y Táº¤T Cáº¢ columns, Táº¤T Cáº¢ rows
SELECT * FROM users;

-- Láº¥y CHá»ˆ Äá»ŠNH columns
SELECT id, name, email FROM users;

-- Láº¥y vá»›i ÄIá»€U KIá»†N
SELECT * FROM users WHERE role = 'ADMIN';

-- Láº¥y vá»›i Sáº®P Xáº¾P vÃ  GIá»šI Háº N
SELECT id, name, email 
FROM users 
ORDER BY created_at DESC  -- Má»›i nháº¥t trÆ°á»›c
LIMIT 10;                  -- Chá»‰ láº¥y 10 records
```

**âœï¸ INSERT - ThÃªm dá»¯ liá»‡u (Create)**

```sql
-- ThÃªm 1 record má»›i
INSERT INTO users (id, name, email, role) 
VALUES ('uuid-123', 'Trung', 'trung@email.com', 'MEMBER');

-- ThÃªm nhiá»u records cÃ¹ng lÃºc
INSERT INTO users (id, name, email, role) VALUES 
  ('uuid-124', 'An', 'an@email.com', 'MEMBER'),
  ('uuid-125', 'BÃ¬nh', 'binh@email.com', 'PM');
```

**ğŸ”„ UPDATE - Cáº­p nháº­t dá»¯ liá»‡u**

```sql
-- Cáº­p nháº­t role cá»§a user cÃ³ id cá»¥ thá»ƒ
UPDATE users 
SET role = 'PM' 
WHERE id = 'uuid-123';

-- Cáº­p nháº­t nhiá»u fields
UPDATE users 
SET role = 'ADMIN', updated_at = NOW() 
WHERE email = 'trung@email.com';

-- âš ï¸ NGUY HIá»‚M: KhÃ´ng cÃ³ WHERE sáº½ update Táº¤T Cáº¢ records!
UPDATE users SET role = 'ADMIN';  -- Táº¥t cáº£ users thÃ nh ADMIN!
```

**ğŸ—‘ï¸ DELETE - XÃ³a dá»¯ liá»‡u**

```sql
-- XÃ³a user cÃ³ id cá»¥ thá»ƒ
DELETE FROM users WHERE id = 'uuid-123';

-- âš ï¸ NGUY HIá»‚M: KhÃ´ng cÃ³ WHERE sáº½ xÃ³a Táº¤T Cáº¢ records!
DELETE FROM users;  -- XÃ³a háº¿t táº¥t cáº£ users!
```

---

#### 2.2.4. JOIN - Káº¿t há»£p báº£ng

**JOIN** Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ káº¿t há»£p dá»¯ liá»‡u tá»« nhiá»u báº£ng dá»±a trÃªn quan há»‡ giá»¯a chÃºng.

```sql
-- Láº¥y tÃªn user vÃ  title project mÃ  há» tham gia
SELECT u.name, p.title 
FROM users u
JOIN project_members pm ON u.id = pm.user_id
JOIN projects p ON pm.project_id = p.id;

-- Káº¿t quáº£:
-- | name   | title        |
-- |--------|--------------|
-- | Trung  | NovaWorkHub  |
-- | An     | NovaWorkHub  |
-- | Trung  | ProjectXYZ   |
```

**CÃ¡c loáº¡i JOIN:**

| Loáº¡i JOIN | MÃ´ táº£ |
|-----------|-------|
| `INNER JOIN` | Chá»‰ láº¥y records cÃ³ match á»Ÿ **Cáº¢ HAI** báº£ng |
| `LEFT JOIN` | Láº¥y **Táº¤T Cáº¢** tá»« báº£ng trÃ¡i, match tá»« báº£ng pháº£i (NULL náº¿u khÃ´ng cÃ³) |
| `RIGHT JOIN` | Láº¥y **Táº¤T Cáº¢** tá»« báº£ng pháº£i, match tá»« báº£ng trÃ¡i (NULL náº¿u khÃ´ng cÃ³) |
| `FULL JOIN` | Láº¥y **Táº¤T Cáº¢** tá»« cáº£ hai báº£ng |

```sql
-- LEFT JOIN: Láº¥y táº¥t cáº£ users, ká»ƒ cáº£ nhá»¯ng ngÆ°á»i chÆ°a join project nÃ o
SELECT u.name, p.title 
FROM users u
LEFT JOIN project_members pm ON u.id = pm.user_id
LEFT JOIN projects p ON pm.project_id = p.id;

-- Káº¿t quáº£:
-- | name   | title        |
-- |--------|--------------|
-- | Trung  | NovaWorkHub  |
-- | An     | NovaWorkHub  |
-- | BÃ¬nh   | NULL         | â† BÃ¬nh chÆ°a join project nÃ o
```

---

#### 2.2.5. á»¨ng dá»¥ng trong NovaWork Hub

Trong dá»± Ã¡n **NovaWork Hub**, báº¡n sáº½ lÃ m viá»‡c vá»›i cÃ¡c báº£ng nhÆ°:

```
ğŸ“Š Database Schema:
â”œâ”€â”€ users          (id, email, name, password, role, avatar)
â”œâ”€â”€ projects       (id, title, description, status, start_date, end_date)
â”œâ”€â”€ project_members(id, user_id, project_id, role, joined_at)  â† Báº£ng trung gian
â”œâ”€â”€ tasks          (id, title, description, status, priority, project_id, assignee_id)
â””â”€â”€ comments       (id, content, task_id, user_id, created_at)

Quan há»‡:
â€¢ users 1-n project_members n-1 projects  (Many-to-Many qua báº£ng trung gian)
â€¢ projects 1-n tasks
â€¢ tasks 1-n comments
â€¢ users 1-n comments
```

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh SQL

**BÃ i 1: Viáº¿t cÃ¢u SELECT**
```sql
-- TODO: Viáº¿t cÃ¢u truy váº¥n Ä‘á»ƒ:
-- 1. Láº¥y táº¥t cáº£ users cÃ³ role lÃ  'PM'
-- 2. Láº¥y 5 projects má»›i nháº¥t
-- 3. Äáº¿m sá»‘ lÆ°á»£ng tasks theo tá»«ng status
```

**BÃ i 2: Viáº¿t cÃ¢u JOIN**
```sql
-- TODO: Viáº¿t cÃ¢u truy váº¥n Ä‘á»ƒ:
-- 1. Láº¥y danh sÃ¡ch tasks kÃ¨m tÃªn project vÃ  tÃªn ngÆ°á»i Ä‘Æ°á»£c assign
-- 2. Láº¥y sá»‘ lÆ°á»£ng thÃ nh viÃªn cá»§a má»—i project
```

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i</strong></summary>

```sql
-- BÃ i 1.1: Users cÃ³ role lÃ  PM
SELECT * FROM users WHERE role = 'PM';

-- BÃ i 1.2: 5 projects má»›i nháº¥t
SELECT * FROM projects ORDER BY created_at DESC LIMIT 5;

-- BÃ i 1.3: Äáº¿m tasks theo status
SELECT status, COUNT(*) as count 
FROM tasks 
GROUP BY status;

-- BÃ i 2.1: Tasks kÃ¨m project vÃ  assignee
SELECT 
  t.id,
  t.title as task_title,
  p.title as project_title,
  u.name as assignee_name
FROM tasks t
JOIN projects p ON t.project_id = p.id
LEFT JOIN users u ON t.assignee_id = u.id;

-- BÃ i 2.2: Sá»‘ thÃ nh viÃªn má»—i project
SELECT 
  p.title,
  COUNT(pm.user_id) as member_count
FROM projects p
LEFT JOIN project_members pm ON p.id = pm.project_id
GROUP BY p.id, p.title;
```

</details>

---

### 2.3. Git & Version Control

**Git** lÃ  há»‡ thá»‘ng quáº£n lÃ½ phiÃªn báº£n (Version Control System - VCS) **phá»• biáº¿n nháº¥t tháº¿ giá»›i**. ÄÃ¢y lÃ  cÃ´ng cá»¥ **báº¯t buá»™c** mÃ  má»i developer pháº£i biáº¿t.

**Táº¡i sao cáº§n Git?**
- ğŸ“ **LÆ°u lá»‹ch sá»­ thay Ä‘á»•i**: Biáº¿t ai Ä‘Ã£ thay Ä‘á»•i gÃ¬, khi nÃ o
- ğŸ”„ **Quay láº¡i phiÃªn báº£n cÅ©**: Náº¿u code bá»‹ há»ng, cÃ³ thá»ƒ rollback
- ğŸ‘¥ **LÃ m viá»‡c nhÃ³m**: Nhiá»u ngÆ°á»i cÃ³ thá»ƒ code cÃ¹ng lÃºc mÃ  khÃ´ng xung Ä‘á»™t
- ğŸŒ¿ **Branching**: PhÃ¡t triá»ƒn tÃ­nh nÄƒng má»›i mÃ  khÃ´ng áº£nh hÆ°á»Ÿng code chÃ­nh

---

#### 2.3.1. CÃ¡c khÃ¡i niá»‡m cá»‘t lÃµi

**ğŸ“ Repository (Repo)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Local Repo     â”‚     push/pull      â”‚  Remote Repo    â”‚
â”‚  (MÃ¡y cá»§a báº¡n)  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  (GitHub)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ Local Repository: Repo trÃªn mÃ¡y tÃ­nh cá»§a báº¡n
â€¢ Remote Repository: Repo trÃªn server (GitHub, GitLab, Bitbucket)
```

**ğŸŒ¿ Branch (NhÃ¡nh)**
```
                    feature/login
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â•±                            â•²
main â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â–º
                                         â”‚
                                   merge feature

â€¢ Main/Master: Branch chÃ­nh, chá»©a code á»•n Ä‘á»‹nh
â€¢ Feature branch: Branch Ä‘á»ƒ phÃ¡t triá»ƒn tÃ­nh nÄƒng má»›i
â€¢ Hotfix branch: Branch Ä‘á»ƒ sá»­a lá»—i kháº©n cáº¥p
```

**ğŸ”„ Staging Area (Index)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    git add    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   git commit   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Working         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Staging Area    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Repository      â”‚
â”‚ Directory       â”‚               â”‚ (Index)         â”‚                â”‚ (.git)          â”‚
â”‚                 â”‚               â”‚                 â”‚                â”‚                 â”‚
â”‚ CÃ¡c file Ä‘ang   â”‚               â”‚ CÃ¡c thay Ä‘á»•i    â”‚                â”‚ Lá»‹ch sá»­ cÃ¡c     â”‚
â”‚ lÃ m viá»‡c        â”‚               â”‚ chuáº©n bá»‹ commit â”‚                â”‚ commits         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“¦ Commit**
- LÃ  má»™t "snapshot" (áº£nh chá»¥p) cá»§a code táº¡i má»™t thá»i Ä‘iá»ƒm
- Má»—i commit cÃ³:
  - **Hash ID**: Äá»‹nh danh duy nháº¥t (vd: `a1b2c3d4`)
  - **Message**: MÃ´ táº£ thay Ä‘á»•i
  - **Author**: NgÆ°á»i táº¡o commit
  - **Timestamp**: Thá»i gian táº¡o

---

#### 2.3.2. CÃ¡c lá»‡nh Git cÆ¡ báº£n

**ğŸš€ Khá»Ÿi táº¡o & Clone**

```bash
# Khá»Ÿi táº¡o repo má»›i
git init

# Clone repo tá»« remote
git clone <repo-url>
git clone https://github.com/username/project.git

# Clone vÃ  Ä‘áº·t tÃªn thÆ° má»¥c khÃ¡c
git clone <repo-url> my-folder
```

**ğŸŒ¿ LÃ m viá»‡c vá»›i Branch**

```bash
# Xem táº¥t cáº£ branches
git branch              # Branches local
git branch -a           # Táº¥t cáº£ branches (cáº£ remote)

# Táº¡o branch má»›i
git branch feature/login

# Táº¡o vÃ  chuyá»ƒn sang branch má»›i (cÃ¡ch nhanh)
git checkout -b feature/login
# Hoáº·c (Git 2.23+)
git switch -c feature/login

# Chuyá»ƒn sang branch khÃ¡c
git checkout main
git switch main

# XÃ³a branch
git branch -d feature/login        # XÃ³a branch Ä‘Ã£ merge
git branch -D feature/login        # XÃ³a branch chÆ°a merge (force)
```

**ğŸ“ Stage & Commit**

```bash
# Xem tráº¡ng thÃ¡i
git status

# Xem thay Ä‘á»•i
git diff                           # Thay Ä‘á»•i chÆ°a stage
git diff --staged                  # Thay Ä‘á»•i Ä‘Ã£ stage

# Stage thay Ä‘á»•i
git add file.txt                   # Stage 1 file
git add .                          # Stage táº¥t cáº£
git add -p                         # Stage tá»«ng pháº§n (interactive)

# Unstage
git reset HEAD file.txt            # Unstage 1 file
git restore --staged file.txt      # CÃ¡ch má»›i (Git 2.23+)

# Commit
git commit -m "feat: add login feature"

# Commit vá»›i message nhiá»u dÃ²ng
git commit -m "feat: add login feature" -m "- Add login form" -m "- Add validation"

# Sá»­a commit cuá»‘i (chÆ°a push)
git commit --amend -m "feat: updated message"
```

**ğŸ”„ Äá»“ng bá»™ vá»›i Remote**

```bash
# ThÃªm remote
git remote add origin https://github.com/username/project.git

# Xem remotes
git remote -v

# Láº¥y thay Ä‘á»•i tá»« remote (khÃ´ng merge)
git fetch origin

# Láº¥y vÃ  merge thay Ä‘á»•i tá»« remote
git pull origin main

# Push lÃªn remote
git push origin feature/login

# Push branch má»›i láº§n Ä‘áº§u
git push -u origin feature/login   # -u = set upstream
```

---

#### 2.3.3. Merge & Rebase

```bash
# Merge branch vÃ o branch hiá»‡n táº¡i
git checkout main
git merge feature/login

# Rebase (lÃ m láº¡i lá»‹ch sá»­ commit)
git checkout feature/login
git rebase main
```

**Merge vs Rebase:**

```
MERGE: Giá»¯ nguyÃªn lá»‹ch sá»­, táº¡o merge commit
       main: â”€â”€Aâ”€â”€Bâ”€â”€Câ”€â”€â”€â”€â”€â”€â”€â”€Mâ”€â”€
                    â•²        â•±
       feature:      Dâ”€â”€Eâ”€â”€F

REBASE: LÃ m pháº³ng lá»‹ch sá»­, replay commits
       main:    â”€â”€Aâ”€â”€Bâ”€â”€Câ”€â”€D'â”€â”€E'â”€â”€F'â”€â”€
       (feature Ä‘Æ°á»£c "di chuyá»ƒn" lÃªn Ä‘áº§u main)
```

| TiÃªu chÃ­ | Merge | Rebase |
|----------|-------|--------|
| **Lá»‹ch sá»­** | Giá»¯ nguyÃªn, cÃ³ merge commit | LÃ m pháº³ng, sáº¡ch sáº½ hÆ¡n |
| **An toÃ n** | An toÃ n hÆ¡n | CÃ³ thá»ƒ gÃ¢y conflict phá»©c táº¡p |
| **Khi nÃ o dÃ¹ng** | Merge feature vÃ o main | Update feature vá»›i main má»›i nháº¥t |
| **Public branch** | âœ… DÃ¹ng Ä‘Æ°á»£c | âš ï¸ KhÃ´ng nÃªn (rewrite history) |

---

#### 2.3.4. HoÃ n tÃ¡c thay Ä‘á»•i

```bash
# HoÃ n tÃ¡c thay Ä‘á»•i chÆ°a stage
git checkout -- file.txt           # CÃ¡ch cÅ©
git restore file.txt               # CÃ¡ch má»›i (Git 2.23+)

# HoÃ n tÃ¡c commit cuá»‘i (giá»¯ thay Ä‘á»•i trong staging)
git reset --soft HEAD~1

# HoÃ n tÃ¡c commit cuá»‘i (giá»¯ thay Ä‘á»•i trong working dir)
git reset --mixed HEAD~1           # Máº·c Ä‘á»‹nh

# HoÃ n tÃ¡c commit cuá»‘i (XÃ“A thay Ä‘á»•i)
git reset --hard HEAD~1            # âš ï¸ NGUY HIá»‚M!

# Táº¡o commit Ä‘áº£o ngÆ°á»£c (an toÃ n hÆ¡n reset)
git revert <commit-hash>
```

**So sÃ¡nh Reset modes:**

| Mode | Staging Area | Working Directory | Khi nÃ o dÃ¹ng |
|------|--------------|-------------------|--------------|
| `--soft` | Giá»¯ nguyÃªn | Giá»¯ nguyÃªn | Muá»‘n sá»­a commit message |
| `--mixed` | Reset | Giá»¯ nguyÃªn | Muá»‘n unstage vÃ  sá»­a láº¡i |
| `--hard` | Reset | Reset | Muá»‘n xÃ³a hoÃ n toÃ n âš ï¸ |

---

#### 2.3.5. Xem lá»‹ch sá»­

```bash
# Xem lá»‹ch sá»­ commits
git log

# Xem ngáº¯n gá»n (1 dÃ²ng má»—i commit)
git log --oneline

# Xem vá»›i graph (visualize branches)
git log --oneline --graph --all

# Xem n commits gáº§n nháº¥t
git log -n 5

# Xem commits cá»§a 1 file
git log --follow file.txt

# Xem ai sá»­a tá»«ng dÃ²ng (blame)
git blame file.txt

# Xem thay Ä‘á»•i cá»§a 1 commit
git show <commit-hash>
```

---

#### 2.3.6. Quy Æ°á»›c Commit Message (Conventional Commits)

**Format chuáº©n:**
```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

**CÃ¡c loáº¡i Type:**

| Type | Má»¥c Ä‘Ã­ch | VÃ­ dá»¥ |
|------|----------|-------|
| `feat` | ThÃªm tÃ­nh nÄƒng má»›i | `feat: add user registration` |
| `fix` | Sá»­a lá»—i | `fix: resolve login crash on iOS` |
| `docs` | Cáº­p nháº­t tÃ i liá»‡u | `docs: update API documentation` |
| `style` | Format code (khÃ´ng Ä‘á»•i logic) | `style: format with prettier` |
| `refactor` | TÃ¡i cáº¥u trÃºc code | `refactor: extract validation logic` |
| `test` | ThÃªm/sá»­a tests | `test: add unit tests for auth` |
| `chore` | CÃ´ng viá»‡c khÃ¡c | `chore: update dependencies` |
| `perf` | Cáº£i thiá»‡n performance | `perf: optimize database queries` |
| `ci` | CI/CD changes | `ci: add GitHub Actions workflow` |

**VÃ­ dá»¥ commit message:**

```bash
# âœ… Tá»‘t
git commit -m "feat(auth): add Google OAuth login"
git commit -m "fix(api): handle null response from server"
git commit -m "docs: add installation guide to README"

# âŒ Xáº¥u - KhÃ´ng rÃµ rÃ ng
git commit -m "fix bug"
git commit -m "update"
git commit -m "asdfasdf"
```

---

#### 2.3.7. Git Workflow trong dá»± Ã¡n

**GitHub Flow (Workflow Ä‘Æ¡n giáº£n, phá»• biáº¿n):**

```
main     â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â–º
              â†–        â†—         â†–       â†—
feature        â”€â”€â—â”€â”€â—â”€â”€           â”€â”€â—â”€â”€â—â”€â”€
                  PR                 PR
```

**Workflow thá»±c táº¿ trong NovaWork Hub:**

```bash
# 1. Láº¥y code má»›i nháº¥t
git checkout main
git pull origin main

# 2. Táº¡o branch má»›i cho feature/fix
git checkout -b feature/add-task-api

# 3. Code vÃ  commit (nhiá»u láº§n)
git add .
git commit -m "feat(task): add create task API"
git commit -m "feat(task): add validation"

# 4. Push lÃªn remote
git push -u origin feature/add-task-api

# 5. Táº¡o Pull Request trÃªn GitHub
#    - MÃ´ táº£ thay Ä‘á»•i
#    - Request review tá»« team members

# 6. Sau khi PR Ä‘Æ°á»£c approve vÃ  merge
git checkout main
git pull origin main

# 7. XÃ³a branch local (dá»n dáº¹p)
git branch -d feature/add-task-api
```

---

#### 2.3.8. Xá»­ lÃ½ Conflict

Khi 2 ngÆ°á»i cÃ¹ng sá»­a 1 file, Git khÃ´ng biáº¿t chá»n phiÃªn báº£n nÃ o â†’ **Conflict**

```
<<<<<<< HEAD
const greeting = "Hello World";     â† Code cá»§a báº¡n (current)
=======
const greeting = "Hi There";        â† Code cá»§a ngÆ°á»i khÃ¡c (incoming)
>>>>>>> feature/other-branch
```

**CÃ¡ch xá»­ lÃ½:**

```bash
# 1. Khi merge/pull bÃ¡o conflict
git merge feature/login
# Auto-merging file.js
# CONFLICT (content): Merge conflict in file.js

# 2. Má»Ÿ file conflict, quyáº¿t Ä‘á»‹nh giá»¯ code nÃ o
#    - Giá»¯ code cá»§a báº¡n
#    - Giá»¯ code incoming
#    - Káº¿t há»£p cáº£ 2

# 3. XÃ³a cÃ¡c markers (<<<<<<<, =======, >>>>>>>)

# 4. Stage file Ä‘Ã£ sá»­a
git add file.js

# 5. HoÃ n táº¥t merge
git commit -m "fix: resolve merge conflict in file.js"
```

**Tips trÃ¡nh conflict:**
- Pull main thÆ°á»ng xuyÃªn vÃ o feature branch
- Chia nhá» task, commit thÆ°á»ng xuyÃªn
- Communicate vá»›i team khi sá»­a cÃ¹ng file

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh Git

**BÃ i 1: Workflow cÆ¡ báº£n**
```bash
# TODO: Thá»±c hÃ nh cÃ¡c bÆ°á»›c sau:
# 1. Clone repo cá»§a báº¡n vá» mÃ¡y
# 2. Táº¡o branch feature/practice
# 3. Táº¡o file má»›i, commit
# 4. Push lÃªn remote
# 5. Quay vá» main, xÃ³a branch local
```

**BÃ i 2: Xá»­ lÃ½ conflict**
```bash
# TODO: Táº¡o conflict vÃ  xá»­ lÃ½:
# 1. Táº¡o 2 branches tá»« main
# 2. á» cáº£ 2 branch, sá»­a cÃ¹ng 1 dÃ²ng trong cÃ¹ng 1 file
# 3. Merge branch 1 vÃ o main
# 4. Merge branch 2 vÃ o main (sáº½ conflict)
# 5. Xá»­ lÃ½ conflict
```

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 1</strong></summary>

```bash
# 1. Clone repo
git clone https://github.com/your-username/nova-work-hub.git
cd nova-work-hub

# 2. Táº¡o branch
git checkout -b feature/practice

# 3. Táº¡o file vÃ  commit
echo "# Practice" > practice.md
git add practice.md
git commit -m "docs: add practice file"

# 4. Push lÃªn remote
git push -u origin feature/practice

# 5. Quay vá» main vÃ  xÃ³a branch
git checkout main
git branch -d feature/practice
git push origin --delete feature/practice  # XÃ³a remote branch
```

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 2</strong></summary>

```bash
# 1. Táº¡o 2 branches
git checkout main
git checkout -b branch-a
git checkout main
git checkout -b branch-b

# 2. Sá»­a file á»Ÿ branch-a
git checkout branch-a
echo "Line from branch A" > test.txt
git add test.txt
git commit -m "feat: add from branch A"

# Sá»­a file á»Ÿ branch-b
git checkout branch-b
echo "Line from branch B" > test.txt
git add test.txt
git commit -m "feat: add from branch B"

# 3. Merge branch-a vÃ o main (OK)
git checkout main
git merge branch-a
# Fast-forward, no conflict

# 4. Merge branch-b vÃ o main (CONFLICT!)
git merge branch-b
# CONFLICT (add/add): Merge conflict in test.txt

# 5. Xá»­ lÃ½ conflict
# Má»Ÿ test.txt, sáº½ tháº¥y:
# <<<<<<< HEAD
# Line from branch A
# =======
# Line from branch B
# >>>>>>> branch-b

# Sá»­a thÃ nh:
# Line from branch A
# Line from branch B

git add test.txt
git commit -m "fix: resolve conflict between branch A and B"
```

</details>

---

## 3. Kiáº¿n thá»©c chuyÃªn sÃ¢u cho dá»± Ã¡n

### 3.1. Prisma ORM (â­â­â­â­â­)

**Prisma** lÃ  má»™t **ORM (Object-Relational Mapping)** hiá»‡n Ä‘áº¡i cho Node.js vÃ  TypeScript. NÃ³ lÃ  **cáº§u ná»‘i** giá»¯a code TypeScript vÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘Ã¢y lÃ  cÃ´ng cá»¥ **quan trá»ng nháº¥t** cho Backend.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TypeScript Code                         â”‚
â”‚         prisma.user.findMany({ where: { role: "ADMIN" } })  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ Prisma Client
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Prisma ORM                             â”‚
â”‚     Tá»± Ä‘á»™ng chuyá»ƒn Ä‘á»•i sang SQL query                       â”‚
â”‚     SELECT * FROM users WHERE role = 'ADMIN'                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PostgreSQL                             â”‚
â”‚                    (Database)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Táº¡i sao dÃ¹ng Prisma?**

| Lá»£i Ã­ch | MÃ´ táº£ |
|---------|-------|
| **Type-safe** | TypeScript types Ä‘Æ°á»£c tá»± Ä‘á»™ng generate tá»« schema |
| **Auto-complete** | IDE hiá»ƒu vÃ  gá»£i Ã½ fields, methods |
| **KhÃ´ng cáº§n viáº¿t SQL** | DÃ¹ng API thÃ¢n thiá»‡n thay vÃ¬ raw SQL |
| **Migrations** | Quáº£n lÃ½ thay Ä‘á»•i database dá»… dÃ ng |
| **Relations** | Xá»­ lÃ½ quan há»‡ giá»¯a cÃ¡c báº£ng Ä‘Æ¡n giáº£n |

**3 thÃ nh pháº§n chÃ­nh cá»§a Prisma:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRISMA ECOSYSTEM                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Prisma Schema  â”‚  Prisma Client  â”‚  Prisma CLI             â”‚
â”‚                 â”‚                 â”‚                         â”‚
â”‚  ğŸ“„ Äá»‹nh nghÄ©a  â”‚  ğŸ”Œ API Ä‘á»ƒ      â”‚  âš™ï¸ CÃ´ng cá»¥ command    â”‚
â”‚  cáº¥u trÃºc DB    â”‚  query database â”‚  line                   â”‚
â”‚                 â”‚                 â”‚                         â”‚
â”‚  schema.prisma  â”‚  @prisma/client â”‚  npx prisma ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 3.1.1. Prisma Schema

File `prisma/schema.prisma` lÃ  **trÃ¡i tim** cá»§a Prisma - Ä‘á»‹nh nghÄ©a toÃ n bá»™ cáº¥u trÃºc database:

```prisma
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. DATASOURCE - Káº¿t ná»‘i database
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
datasource db {
  provider = "postgresql"           // Loáº¡i DB: postgresql, mysql, sqlite
  url      = env("DATABASE_URL")    // Connection string tá»« .env
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. GENERATOR - Generate Prisma Client
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
generator client {
  provider = "prisma-client-js"     // Generate JavaScript client
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. MODELS - Äá»‹nh nghÄ©a cÃ¡c báº£ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
model User {
  // CÃ¡c fields
  id        String   @id @default(cuid())   // Primary key
  email     String   @unique                 // Unique constraint
  name      String
  password  String
  role      Role     @default(MEMBER)        // Enum vá»›i default
  avatar    String?                          // Optional (nullable)
  createdAt DateTime @default(now())         // Auto timestamp
  updatedAt DateTime @updatedAt              // Auto update timestamp

  // Relations
  projects  ProjectMember[]                  // One-to-Many
  tasks     Task[]
  comments  Comment[]

  @@map("users")                             // TÃªn báº£ng trong DB
}

// Model Project
model Project {
  id          String   @id @default(cuid())
  title       String
  description String?
  status      ProjectStatus @default(ACTIVE)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  members     ProjectMember[]
  tasks       Task[]

  @@map("projects")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. ENUMS - GiÃ¡ trá»‹ cá»‘ Ä‘á»‹nh
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
enum Role {
  ADMIN
  PM
  MEMBER
}

enum ProjectStatus {
  ACTIVE
  COMPLETED
  ARCHIVED
}
```

**CÃ¡c Attributes quan trá»ng:**

| Attribute | Ã nghÄ©a | VÃ­ dá»¥ |
|-----------|---------|-------|
| `@id` | Primary Key | `id String @id` |
| `@default()` | GiÃ¡ trá»‹ máº·c Ä‘á»‹nh | `@default(cuid())`, `@default(now())` |
| `@unique` | Unique constraint | `email String @unique` |
| `@updatedAt` | Tá»± Ä‘á»™ng cáº­p nháº­t timestamp | `updatedAt DateTime @updatedAt` |
| `?` | Optional (nullable) | `avatar String?` |
| `@@map()` | Äáº·t tÃªn báº£ng trong DB | `@@map("users")` |
| `@@unique()` | Composite unique | `@@unique([email, projectId])` |
| `@@index()` | Táº¡o index | `@@index([email])` |

**CÃ¡c kiá»ƒu dá»¯ liá»‡u:**

| Prisma Type | PostgreSQL | TypeScript |
|-------------|------------|------------|
| `String` | TEXT, VARCHAR | `string` |
| `Int` | INTEGER | `number` |
| `Float` | DOUBLE PRECISION | `number` |
| `Boolean` | BOOLEAN | `boolean` |
| `DateTime` | TIMESTAMP | `Date` |
| `Json` | JSONB | `object` |

---

#### 3.1.2. Relations - Quan há»‡ giá»¯a cÃ¡c Models

**One-to-One (1-1):**
```prisma
model User {
  id      String   @id @default(cuid())
  profile Profile?                        // Optional 1-1
}

model Profile {
  id     String @id @default(cuid())
  bio    String
  userId String @unique                   // FK + UNIQUE = 1-1
  user   User   @relation(fields: [userId], references: [id])
}
```

**One-to-Many (1-n):**
```prisma
model Project {
  id    String @id @default(cuid())
  title String
  tasks Task[]                            // Má»™t project cÃ³ nhiá»u tasks
}

model Task {
  id        String  @id @default(cuid())
  title     String
  projectId String                        // Foreign Key
  project   Project @relation(fields: [projectId], references: [id])
}
```

**Many-to-Many (n-n) - Explicit (Khuyáº¿n nghá»‹):**
```prisma
model User {
  id       String          @id @default(cuid())
  projects ProjectMember[]
}

model Project {
  id      String          @id @default(cuid())
  members ProjectMember[]
}

// Báº£ng trung gian - cÃ³ thá»ƒ thÃªm thÃ´ng tin vá» relation
model ProjectMember {
  id        String   @id @default(cuid())
  userId    String
  projectId String
  role      String                         // ThÃªm thÃ´ng tin vá» relation
  joinedAt  DateTime @default(now())
  
  user    User    @relation(fields: [userId], references: [id])
  project Project @relation(fields: [projectId], references: [id])
  
  @@unique([userId, projectId])            // 1 user chá»‰ join 1 project 1 láº§n
}
```

---

#### 3.1.3. Prisma Client - Khá»Ÿi táº¡o

**Best practice - Singleton pattern (trÃ¡nh táº¡o nhiá»u connections):**

```typescript
// lib/prisma.ts
import { PrismaClient } from "@prisma/client";

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma = globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== "production") {
  globalForPrisma.prisma = prisma;
}
```

---

#### 3.1.4. CRUD Operations

**CREATE - Táº¡o má»›i:**

```typescript
// Táº¡o 1 record
const user = await prisma.user.create({
  data: {
    email: "trung@email.com",
    name: "Trung Äáº·ng",
    password: await bcrypt.hash("123456", 12),
  },
});

// Táº¡o kÃ¨m relations (nested create)
const project = await prisma.project.create({
  data: {
    title: "NovaWork Hub",
    members: {
      create: [
        { userId: "user-1", role: "OWNER" },
        { userId: "user-2", role: "MEMBER" },
      ],
    },
  },
  include: {
    members: true,
  },
});

// Táº¡o nhiá»u records cÃ¹ng lÃºc
const users = await prisma.user.createMany({
  data: [
    { email: "a@mail.com", name: "A", password: "..." },
    { email: "b@mail.com", name: "B", password: "..." },
  ],
  skipDuplicates: true,  // Bá» qua náº¿u Ä‘Ã£ tá»“n táº¡i
});
```

**READ - Äá»c dá»¯ liá»‡u:**

```typescript
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// findUnique - TÃ¬m 1 record theo unique field
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const user = await prisma.user.findUnique({
  where: { id: "user-123" },
});

const userByEmail = await prisma.user.findUnique({
  where: { email: "trung@email.com" },
});

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// findFirst - TÃ¬m 1 record Ä‘áº§u tiÃªn match Ä‘iá»u kiá»‡n
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const admin = await prisma.user.findFirst({
  where: { role: "ADMIN" },
});

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// findMany - TÃ¬m nhiá»u records
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const users = await prisma.user.findMany({
  where: { role: "MEMBER" },
  orderBy: { createdAt: "desc" },
  take: 10,   // LIMIT
  skip: 0,    // OFFSET (pagination)
});

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// select - Chá»‰ láº¥y má»™t sá»‘ fields (giáº£m data transfer)
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const userPreview = await prisma.user.findUnique({
  where: { id: "user-123" },
  select: {
    id: true,
    name: true,
    avatar: true,
    // KhÃ´ng láº¥y password, email
  },
});

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// include - Láº¥y kÃ¨m relations
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const userWithProjects = await prisma.user.findUnique({
  where: { id: "user-123" },
  include: {
    projects: {
      include: {
        project: true,
      },
    },
    tasks: {
      where: { status: "IN_PROGRESS" },
      orderBy: { createdAt: "desc" },
    },
  },
});
```

**WHERE Conditions - Äiá»u kiá»‡n lá»c:**

```typescript
const users = await prisma.user.findMany({
  where: {
    // Equals
    role: "ADMIN",
    
    // Not equals
    role: { not: "ADMIN" },
    
    // In array
    role: { in: ["ADMIN", "PM"] },
    
    // String contains
    email: { contains: "gmail" },
    
    // String starts/ends with
    name: { startsWith: "Trung" },
    
    // Comparison (gt, gte, lt, lte)
    age: { gte: 18 },     // >= 18
    
    // Date comparison
    createdAt: { gte: new Date("2024-01-01") },
    
    // Null check
    avatar: null,         // IS NULL
    avatar: { not: null }, // IS NOT NULL
    
    // OR condition
    OR: [
      { role: "ADMIN" },
      { role: "PM" },
    ],
    
    // AND condition (máº·c Ä‘á»‹nh)
    AND: [
      { role: "MEMBER" },
      { email: { contains: "@company.com" } },
    ],
  },
});
```

**UPDATE - Cáº­p nháº­t:**

```typescript
// Update 1 record
const user = await prisma.user.update({
  where: { id: "user-123" },
  data: { name: "New Name", role: "PM" },
});

// Update nhiá»u records
const count = await prisma.user.updateMany({
  where: { role: "MEMBER" },
  data: { role: "PM" },
});
// count = { count: 5 } // Sá»‘ records Ä‘Ã£ update

// Update vá»›i increment/decrement
const post = await prisma.post.update({
  where: { id: "post-123" },
  data: {
    viewCount: { increment: 1 },
  },
});
```

**DELETE - XÃ³a:**

```typescript
// XÃ³a 1 record
await prisma.user.delete({
  where: { id: "user-123" },
});

// XÃ³a nhiá»u records
const count = await prisma.user.deleteMany({
  where: { role: "MEMBER" },
});
```

**UPSERT - Táº¡o hoáº·c cáº­p nháº­t:**

```typescript
// Náº¿u chÆ°a cÃ³ â†’ create, Ä‘Ã£ cÃ³ â†’ update
const user = await prisma.user.upsert({
  where: { email: "trung@email.com" },
  create: {
    email: "trung@email.com",
    name: "Trung",
    password: "...",
  },
  update: {
    name: "Trung Updated",
  },
});
```

---

#### 3.1.5. Aggregations - TÃ­nh toÃ¡n

```typescript
// Count
const userCount = await prisma.user.count({
  where: { role: "ADMIN" },
});

// Aggregate (sum, avg, min, max)
const stats = await prisma.task.aggregate({
  _count: true,
  _avg: { priority: true },
  _sum: { estimatedHours: true },
});

// Group by
const tasksByStatus = await prisma.task.groupBy({
  by: ["status"],
  _count: true,
  orderBy: { _count: { status: "desc" } },
});
// [{ status: "TODO", _count: 10 }, { status: "DONE", _count: 5 }]
```

---

#### 3.1.6. Prisma Migrations

**Migrations** lÃ  cÃ¡ch quáº£n lÃ½ thay Ä‘á»•i cáº¥u trÃºc database theo thá»i gian:

```
Schema thay Ä‘á»•i          Migration Ä‘Æ°á»£c táº¡o         Database Ä‘Æ°á»£c update
     â”‚                         â”‚                          â”‚
     â–¼                         â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    prisma     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    prisma   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ schema  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ migrations/  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Database â”‚
â”‚.prisma  â”‚  migrate dev  â”‚ 2024_01_01/  â”‚  migrate    â”‚ PostgreSQL
â”‚         â”‚               â”‚ migration.sqlâ”‚  deploy     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CÃ¡c lá»‡nh Migration:**

```bash
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Development - Táº¡o vÃ  apply migration
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
npx prisma migrate dev --name add_user_avatar
# 1. So sÃ¡nh schema vá»›i database
# 2. Táº¡o migration SQL
# 3. Apply migration
# 4. Generate Prisma Client

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Production - Chá»‰ apply migration (khÃ´ng táº¡o má»›i)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
npx prisma migrate deploy

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Reset database (XÃ“A TOÃ€N Bá»˜ Dá»® LIá»†U!)
# âš ï¸ Chá»‰ dÃ¹ng trong development!
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
npx prisma migrate reset
```

**CÃ¡c CLI commands khÃ¡c:**

```bash
# Generate Prisma Client (sau khi sá»­a schema)
npx prisma generate

# Má»Ÿ Prisma Studio (GUI xem database)
npx prisma studio

# Push schema trá»±c tiáº¿p (khÃ´ng táº¡o migration - chá»‰ prototype)
npx prisma db push

# Validate schema
npx prisma validate

# Format schema file
npx prisma format
```

---

#### 3.1.7. Best Practices

**1. Xá»­ lÃ½ lá»—i Ä‘Ãºng cÃ¡ch:**
```typescript
import { Prisma } from "@prisma/client";

try {
  await prisma.user.create({ data: { email: "trung@email.com", ... } });
} catch (error) {
  if (error instanceof Prisma.PrismaClientKnownRequestError) {
    if (error.code === "P2002") {
      // Unique constraint violation
      throw new Error("Email Ä‘Ã£ tá»“n táº¡i");
    }
    if (error.code === "P2025") {
      // Record not found
      throw new Error("KhÃ´ng tÃ¬m tháº¥y record");
    }
  }
  throw error;
}
```

**2. Transaction - Äáº£m báº£o tÃ­nh toÃ n váº¹n:**
```typescript
// Náº¿u 1 operation fail â†’ rollback táº¥t cáº£
const result = await prisma.$transaction(async (tx) => {
  const user = await tx.user.create({ data: { ... } });
  const profile = await tx.profile.create({ 
    data: { userId: user.id, ... } 
  });
  return { user, profile };
});
```

**3. Pagination helper:**
```typescript
async function getPaginatedUsers(page: number, pageSize: number) {
  const skip = (page - 1) * pageSize;
  
  const [users, total] = await prisma.$transaction([
    prisma.user.findMany({
      skip,
      take: pageSize,
      orderBy: { createdAt: "desc" },
    }),
    prisma.user.count(),
  ]);
  
  return {
    data: users,
    pagination: {
      page,
      pageSize,
      total,
      totalPages: Math.ceil(total / pageSize),
    },
  };
}
```

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh Prisma

**BÃ i 1: Táº¡o Prisma Schema**
```prisma
// TODO: Táº¡o schema cho Blog vá»›i:
// - Model Post (id, title, content, published, authorId, createdAt)
// - Model Author (id, name, email, posts)
// - Quan há»‡: 1 Author cÃ³ nhiá»u Posts
```

**BÃ i 2: Viáº¿t CRUD Operations**
```typescript
// TODO: Viáº¿t cÃ¡c hÃ m sau:
// - createPost(title, content, authorId)
// - getPublishedPosts(page, pageSize)
// - updatePost(id, data)
// - deletePost(id)
```

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 1</strong></summary>

```prisma
model Author {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  
  posts     Post[]                        // One-to-Many
  
  @@map("authors")
}

model Post {
  id        String   @id @default(cuid())
  title     String
  content   String
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  authorId  String                        // Foreign Key
  author    Author   @relation(fields: [authorId], references: [id])
  
  @@map("posts")
}
```

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 2</strong></summary>

```typescript
import { prisma } from "@/lib/prisma";

// CREATE
async function createPost(title: string, content: string, authorId: string) {
  return prisma.post.create({
    data: { title, content, authorId },
    include: { author: true },
  });
}

// READ with pagination
async function getPublishedPosts(page: number, pageSize: number) {
  const skip = (page - 1) * pageSize;
  
  const [posts, total] = await prisma.$transaction([
    prisma.post.findMany({
      where: { published: true },
      skip,
      take: pageSize,
      orderBy: { createdAt: "desc" },
      include: { author: { select: { name: true } } },
    }),
    prisma.post.count({ where: { published: true } }),
  ]);
  
  return { posts, total, totalPages: Math.ceil(total / pageSize) };
}

// UPDATE
async function updatePost(id: string, data: { title?: string; content?: string; published?: boolean }) {
  return prisma.post.update({
    where: { id },
    data,
  });
}

// DELETE
async function deletePost(id: string) {
  return prisma.post.delete({
    where: { id },
  });
}
```

</details>

---

### 3.2. Server Actions (Next.js 15)

**Server Actions** lÃ  tÃ­nh nÄƒng máº¡nh máº½ trong Next.js 15, cho phÃ©p gá»i hÃ m server **trá»±c tiáº¿p tá»« client** mÃ  khÃ´ng cáº§n táº¡o API Routes.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CÃCH TRUYá»€N THá»NG (API Routes)               â”‚
â”‚                                                                     â”‚
â”‚   Client Component              API Route              Database     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    fetch()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Form      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚ /api/users  â”‚ â”€â”€â”€â”€â”€â–º â”‚ Prisma â”‚   â”‚
â”‚   â”‚   Submit    â”‚              â”‚ POST handlerâ”‚        â”‚        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â—„â”€â”€â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     JSON                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVER ACTIONS (Má»›i)                         â”‚
â”‚                                                                     â”‚
â”‚   Client Component                                     Database     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Form      â”‚  direct call â”‚ createUser()â”‚        â”‚ Prisma â”‚   â”‚
â”‚   â”‚   Submit    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ "use server"â”‚ â”€â”€â”€â”€â”€â–º â”‚        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â—„â”€â”€â”€â”€â”€ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     result                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Táº¡i sao dÃ¹ng Server Actions?**

| Lá»£i Ã­ch | MÃ´ táº£ |
|---------|-------|
| **ÄÆ¡n giáº£n hÆ¡n** | KhÃ´ng cáº§n táº¡o API routes, fetch, xá»­ lÃ½ response |
| **Type-safe** | TypeScript types tá»± Ä‘á»™ng Ä‘Æ°á»£c infer giá»¯a client vÃ  server |
| **Progressive Enhancement** | Form váº«n hoáº¡t Ä‘á»™ng khi JavaScript bá»‹ táº¯t |
| **TÃ­ch há»£p vá»›i React** | DÃ¹ng trá»±c tiáº¿p trong form action, useTransition |
| **Báº£o máº­t** | Server code khÃ´ng bao giá» Ä‘Æ°á»£c gá»­i Ä‘áº¿n client |
| **Caching** | TÃ­ch há»£p vá»›i Next.js caching (revalidatePath, revalidateTag) |

**Khi nÃ o dÃ¹ng Server Actions vs API Routes?**

| TÃ¬nh huá»‘ng | DÃ¹ng |
|------------|------|
| Form submission (CRUD) | âœ… Server Actions |
| Mutations (táº¡o, sá»­a, xÃ³a) | âœ… Server Actions |
| Cáº§n gá»i tá»« mobile app | âŒ API Routes |
| Webhook tá»« service bÃªn ngoÃ i | âŒ API Routes |
| Public API cho third-party | âŒ API Routes |

---

#### 3.2.1. Cáº¥u trÃºc thÆ° má»¥c

```
src/
â”œâ”€â”€ actions/                      # ThÆ° má»¥c chá»©a táº¥t cáº£ Server Actions
â”‚   â”œâ”€â”€ user.actions.ts           # Actions liÃªn quan Ä‘áº¿n User
â”‚   â”œâ”€â”€ project.actions.ts        # Actions liÃªn quan Ä‘áº¿n Project
â”‚   â”œâ”€â”€ task.actions.ts           # Actions liÃªn quan Ä‘áº¿n Task
â”‚   â””â”€â”€ auth.actions.ts           # Actions liÃªn quan Ä‘áº¿n Auth
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ prisma.ts                 # Prisma client
â”‚   â””â”€â”€ auth.ts                   # Auth config
â””â”€â”€ app/
    â””â”€â”€ ...
```

---

#### 3.2.2. CÃº phÃ¡p cÆ¡ báº£n

**CÃ¡ch 1: Trong file riÃªng (khuyáº¿n nghá»‹)**

```typescript
// src/actions/user.actions.ts
"use server";  // â† Directive Báº®T BUá»˜C á»Ÿ Ä‘áº§u file

import { prisma } from "@/lib/prisma";
import { revalidatePath } from "next/cache";

export async function createUser(data: { name: string; email: string }) {
  // Code cháº¡y trÃªn server
  const user = await prisma.user.create({ data });
  
  revalidatePath("/users");
  return user;
}

export async function deleteUser(id: string) {
  await prisma.user.delete({ where: { id } });
  revalidatePath("/users");
}
```

**CÃ¡ch 2: Trong Server Component**

```typescript
// app/users/page.tsx (Server Component)
export default async function UsersPage() {
  
  // Äá»‹nh nghÄ©a action trá»±c tiáº¿p trong component
  async function addUser(formData: FormData) {
    "use server";  // â† Directive trong function
    
    const name = formData.get("name") as string;
    await prisma.user.create({ data: { name } });
    revalidatePath("/users");
  }
  
  return (
    <form action={addUser}>
      <input name="name" />
      <button type="submit">Add</button>
    </form>
  );
}
```

---

#### 3.2.3. Gá»i Server Action tá»« Client

**CÃ¡ch 1: Trong form action (Ä‘Æ¡n giáº£n nháº¥t)**

```typescript
import { createUser } from "@/actions/user.actions";

// Server Action Ä‘Æ°á»£c gá»i tá»± Ä‘á»™ng khi submit form
<form action={createUser}>
  <input name="name" />
  <input name="email" type="email" />
  <button type="submit">Create User</button>
</form>
```

**CÃ¡ch 2: Vá»›i useTransition (hiá»ƒn thá»‹ loading state)**

```typescript
"use client";
import { useTransition } from "react";
import { createUser } from "@/actions/user.actions";

function CreateUserButton() {
  const [isPending, startTransition] = useTransition();
  
  async function handleClick() {
    startTransition(async () => {
      const result = await createUser({ 
        name: "Trung", 
        email: "trung@email.com" 
      });
      
      if (result.success) {
        toast.success("Táº¡o user thÃ nh cÃ´ng!");
      } else {
        toast.error(result.error);
      }
    });
  }
  
  return (
    <button onClick={handleClick} disabled={isPending}>
      {isPending ? "Äang táº¡o..." : "Táº¡o User"}
    </button>
  );
}
```

**CÃ¡ch 3: Vá»›i useActionState (React 19 / Next.js 15)**

```typescript
"use client";
import { useActionState } from "react";
import { createUser } from "@/actions/user.actions";

function CreateUserForm() {
  const [state, formAction, isPending] = useActionState(createUser, null);
  
  return (
    <form action={formAction}>
      <input name="name" placeholder="TÃªn" />
      <input name="email" type="email" placeholder="Email" />
      
      {/* Hiá»ƒn thá»‹ lá»—i náº¿u cÃ³ */}
      {state?.error && <p className="text-red-500">{state.error}</p>}
      
      <button disabled={isPending}>
        {isPending ? "Äang táº¡o..." : "Táº¡o User"}
      </button>
    </form>
  );
}
```

---

#### 3.2.4. Pattern chuáº©n cho Server Actions

**Return Type thá»‘ng nháº¥t:**

```typescript
// Äá»‹nh nghÄ©a type cho táº¥t cáº£ actions
type ActionResult<T = void> = 
  | { success: true; data: T }
  | { success: false; error: string };
```

**Cáº¥u trÃºc Action hoÃ n chá»‰nh:**

```typescript
// src/actions/user.actions.ts
"use server";

import { prisma } from "@/lib/prisma";
import { auth } from "@/lib/auth";
import { revalidatePath } from "next/cache";
import { z } from "zod";
import bcrypt from "bcryptjs";

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 1. SCHEMA VALIDATION
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const CreateUserSchema = z.object({
  email: z.string().email("Email khÃ´ng há»£p lá»‡"),
  name: z.string().min(2, "TÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±"),
  password: z.string().min(6, "Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±"),
  role: z.enum(["ADMIN", "PM", "MEMBER"]).default("MEMBER"),
});

type CreateUserInput = z.infer<typeof CreateUserSchema>;

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 2. RESULT TYPE
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
type ActionResult<T = void> = 
  | { success: true; data: T }
  | { success: false; error: string };

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// 3. ACTION FUNCTION
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
export async function createUser(
  input: CreateUserInput
): Promise<ActionResult<{ id: string }>> {
  try {
    // STEP 1: Authentication - Kiá»ƒm tra Ä‘Äƒng nháº­p
    const session = await auth();
    if (!session?.user) {
      return { success: false, error: "Báº¡n chÆ°a Ä‘Äƒng nháº­p" };
    }

    // STEP 2: Authorization - Kiá»ƒm tra quyá»n
    if (session.user.role !== "ADMIN") {
      return { success: false, error: "Báº¡n khÃ´ng cÃ³ quyá»n thá»±c hiá»‡n" };
    }

    // STEP 3: Validation - Kiá»ƒm tra dá»¯ liá»‡u
    const validatedData = CreateUserSchema.safeParse(input);
    if (!validatedData.success) {
      return { 
        success: false, 
        error: validatedData.error.errors[0].message 
      };
    }

    // STEP 4: Business Logic - Kiá»ƒm tra email Ä‘Ã£ tá»“n táº¡i
    const existingUser = await prisma.user.findUnique({
      where: { email: validatedData.data.email },
    });
    if (existingUser) {
      return { success: false, error: "Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng" };
    }

    // STEP 5: Hash password
    const hashedPassword = await bcrypt.hash(
      validatedData.data.password, 
      12
    );

    // STEP 6: Database Operation
    const user = await prisma.user.create({
      data: {
        ...validatedData.data,
        password: hashedPassword,
      },
    });

    // STEP 7: Cache Revalidation
    revalidatePath("/admin/users");

    // STEP 8: Return Success
    return { success: true, data: { id: user.id } };
    
  } catch (error) {
    console.error("Create user error:", error);
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}
```

---

#### 3.2.5. CÃ¡c patterns thÆ°á»ng dÃ¹ng

**Pattern 1: Action vá»›i ID (bind)**

```typescript
// Actions cáº§n tham sá»‘ cá»‘ Ä‘á»‹nh
"use server";

export async function deleteUser(userId: string) {
  await prisma.user.delete({ where: { id: userId } });
  revalidatePath("/admin/users");
  return { success: true };
}

// Client - bind tham sá»‘ vÃ o action
import { deleteUser } from "@/actions/user.actions";

function DeleteButton({ userId }: { userId: string }) {
  const deleteUserWithId = deleteUser.bind(null, userId);
  
  return (
    <form action={deleteUserWithId}>
      <button type="submit" className="text-red-500">
        XÃ³a
      </button>
    </form>
  );
}
```

**Pattern 2: Form vá»›i FormData**

```typescript
// Action nháº­n FormData trá»±c tiáº¿p
"use server";

export async function createPost(formData: FormData) {
  const title = formData.get("title") as string;
  const content = formData.get("content") as string;
  
  if (!title || title.length < 3) {
    return { success: false, error: "TiÃªu Ä‘á» quÃ¡ ngáº¯n" };
  }
  
  const post = await prisma.post.create({
    data: { title, content },
  });
  
  revalidatePath("/posts");
  return { success: true, data: { id: post.id } };
}

// Client
<form action={createPost}>
  <input name="title" placeholder="TiÃªu Ä‘á»" required />
  <textarea name="content" placeholder="Ná»™i dung" />
  <button type="submit">Táº¡o bÃ i viáº¿t</button>
</form>
```

**Pattern 3: Redirect sau action**

```typescript
"use server";
import { redirect } from "next/navigation";

export async function createProject(data: ProjectInput) {
  const project = await prisma.project.create({ data });
  
  revalidatePath("/projects");
  
  // Redirect Ä‘áº¿n trang chi tiáº¿t
  redirect(`/projects/${project.id}`);
  // âš ï¸ KhÃ´ng return gÃ¬ sau redirect
}
```

---

#### 3.2.6. Cache Revalidation

**revalidatePath - Revalidate theo path:**

```typescript
"use server";
import { revalidatePath } from "next/cache";

export async function createUser(data: UserInput) {
  await prisma.user.create({ data });
  
  // Revalidate 1 path cá»¥ thá»ƒ
  revalidatePath("/users");
  
  // Revalidate vá»›i layout
  revalidatePath("/users", "layout");
  
  // Revalidate dynamic route
  revalidatePath("/users/[id]", "page");
}
```

**revalidateTag - Revalidate theo tag:**

```typescript
"use server";
import { revalidateTag } from "next/cache";

export async function createUser(data: UserInput) {
  await prisma.user.create({ data });
  
  // Revalidate táº¥t cáº£ data cÃ³ tag "users"
  revalidateTag("users");
}
```

---

#### 3.2.7. Error Handling

```typescript
"use server";
import { Prisma } from "@prisma/client";

export async function createUser(
  input: CreateUserInput
): Promise<ActionResult<{ id: string }>> {
  try {
    // Validate
    const validatedData = CreateUserSchema.safeParse(input);
    if (!validatedData.success) {
      return { 
        success: false, 
        error: validatedData.error.errors[0].message,
      };
    }
    
    // Create
    const user = await prisma.user.create({ 
      data: validatedData.data 
    });
    
    return { success: true, data: { id: user.id } };
    
  } catch (error) {
    // Xá»­ lÃ½ lá»—i Prisma cá»¥ thá»ƒ
    if (error instanceof Prisma.PrismaClientKnownRequestError) {
      if (error.code === "P2002") {
        return { success: false, error: "Email Ä‘Ã£ tá»“n táº¡i" };
      }
      if (error.code === "P2025") {
        return { success: false, error: "KhÃ´ng tÃ¬m tháº¥y record" };
      }
    }
    
    // Log lá»—i khÃ´ng mong muá»‘n
    console.error("Unexpected error:", error);
    
    // Return lá»—i chung (khÃ´ng expose chi tiáº¿t cho client)
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}
```

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh Server Actions

**BÃ i 1: Táº¡o CRUD Actions cho Task**
```typescript
// TODO: Táº¡o cÃ¡c actions sau:
// - createTask(title, description, projectId)
// - updateTask(id, data)
// - deleteTask(id)
// - toggleTaskStatus(id)
```

**BÃ i 2: Táº¡o Form vá»›i validation**
```typescript
// TODO: Táº¡o form táº¡o Project vá»›i:
// - Validation: title min 3 kÃ½ tá»±
// - Hiá»ƒn thá»‹ loading state
// - Hiá»ƒn thá»‹ error message
// - Redirect vá» /projects sau khi táº¡o thÃ nh cÃ´ng
```

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 1</strong></summary>

```typescript
// src/actions/task.actions.ts
"use server";

import { prisma } from "@/lib/prisma";
import { auth } from "@/lib/auth";
import { revalidatePath } from "next/cache";
import { z } from "zod";

type ActionResult<T = void> = 
  | { success: true; data: T }
  | { success: false; error: string };

// CREATE
const CreateTaskSchema = z.object({
  title: z.string().min(1, "TiÃªu Ä‘á» khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng"),
  description: z.string().optional(),
  projectId: z.string().cuid(),
});

export async function createTask(
  input: z.infer<typeof CreateTaskSchema>
): Promise<ActionResult<{ id: string }>> {
  try {
    const session = await auth();
    if (!session?.user) {
      return { success: false, error: "ChÆ°a Ä‘Äƒng nháº­p" };
    }

    const validatedData = CreateTaskSchema.safeParse(input);
    if (!validatedData.success) {
      return { success: false, error: validatedData.error.errors[0].message };
    }

    const task = await prisma.task.create({
      data: {
        ...validatedData.data,
        status: "TODO",
        assigneeId: session.user.id,
      },
    });

    revalidatePath(`/projects/${input.projectId}`);
    return { success: true, data: { id: task.id } };
  } catch (error) {
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}

// UPDATE
export async function updateTask(
  id: string,
  data: { title?: string; description?: string; status?: string }
): Promise<ActionResult> {
  try {
    const task = await prisma.task.update({
      where: { id },
      data,
    });
    
    revalidatePath(`/projects/${task.projectId}`);
    return { success: true, data: undefined };
  } catch (error) {
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}

// DELETE
export async function deleteTask(id: string): Promise<ActionResult> {
  try {
    const task = await prisma.task.delete({ where: { id } });
    
    revalidatePath(`/projects/${task.projectId}`);
    return { success: true, data: undefined };
  } catch (error) {
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}

// TOGGLE STATUS
export async function toggleTaskStatus(id: string): Promise<ActionResult> {
  try {
    const task = await prisma.task.findUnique({ where: { id } });
    if (!task) {
      return { success: false, error: "Task khÃ´ng tá»“n táº¡i" };
    }

    const newStatus = task.status === "DONE" ? "TODO" : "DONE";
    
    await prisma.task.update({
      where: { id },
      data: { status: newStatus },
    });

    revalidatePath(`/projects/${task.projectId}`);
    return { success: true, data: undefined };
  } catch (error) {
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}
```

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 2</strong></summary>

```typescript
// src/actions/project.actions.ts
"use server";

import { prisma } from "@/lib/prisma";
import { auth } from "@/lib/auth";
import { revalidatePath } from "next/cache";
import { redirect } from "next/navigation";
import { z } from "zod";

const CreateProjectSchema = z.object({
  title: z.string().min(3, "TiÃªu Ä‘á» pháº£i cÃ³ Ã­t nháº¥t 3 kÃ½ tá»±"),
  description: z.string().optional(),
});

type ActionResult = 
  | { success: true; data: { id: string } }
  | { success: false; error: string };

export async function createProject(
  formData: FormData
): Promise<ActionResult> {
  const session = await auth();
  if (!session?.user) {
    return { success: false, error: "ChÆ°a Ä‘Äƒng nháº­p" };
  }

  const input = {
    title: formData.get("title") as string,
    description: formData.get("description") as string,
  };

  const validatedData = CreateProjectSchema.safeParse(input);
  if (!validatedData.success) {
    return { 
      success: false, 
      error: validatedData.error.errors[0].message 
    };
  }

  const project = await prisma.project.create({
    data: validatedData.data,
  });

  revalidatePath("/projects");
  redirect(`/projects/${project.id}`);
}
```

```typescript
// app/projects/new/page.tsx
"use client";

import { useActionState } from "react";
import { createProject } from "@/actions/project.actions";

export default function NewProjectPage() {
  const [state, formAction, isPending] = useActionState(createProject, null);

  return (
    <div className="max-w-md mx-auto p-6">
      <h1 className="text-2xl font-bold mb-4">Táº¡o Project má»›i</h1>
      
      <form action={formAction} className="space-y-4">
        <div>
          <label className="block mb-1">TiÃªu Ä‘á»</label>
          <input 
            name="title" 
            className="w-full border p-2 rounded"
            placeholder="Nháº­p tiÃªu Ä‘á» project"
            required
          />
        </div>
        
        <div>
          <label className="block mb-1">MÃ´ táº£</label>
          <textarea 
            name="description"
            className="w-full border p-2 rounded"
            placeholder="Nháº­p mÃ´ táº£ (khÃ´ng báº¯t buá»™c)"
          />
        </div>
        
        {state?.error && (
          <div className="bg-red-100 text-red-700 p-2 rounded">
            {state.error}
          </div>
        )}
        
        <button 
          type="submit" 
          disabled={isPending}
          className="w-full bg-blue-500 text-white p-2 rounded disabled:opacity-50"
        >
          {isPending ? "Äang táº¡o..." : "Táº¡o Project"}
        </button>
      </form>
    </div>
  );
}
```

</details>

---

### 3.3. Zod Validation

**Zod** lÃ  thÆ° viá»‡n **validation schema-first** cho TypeScript. NÃ³ cho phÃ©p báº¡n Ä‘á»‹nh nghÄ©a **schema** (cáº¥u trÃºc dá»¯ liá»‡u) vÃ  tá»± Ä‘á»™ng **validate** + **generate types**.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ZOD WORKFLOW                                â”‚
â”‚                                                                     â”‚
â”‚   1. Äá»‹nh nghÄ©a Schema          2. TypeScript Type        3. Validate
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚ z.object({      â”‚   infer  â”‚ type User = {   â”‚      â”‚ schema   â”‚
â”‚   â”‚   name: z.      â”‚ â”€â”€â”€â”€â”€â”€â–º  â”‚   name: string  â”‚      â”‚.safeParseâ”‚
â”‚   â”‚     string()    â”‚          â”‚ }               â”‚      â”‚ (data)   â”‚
â”‚   â”‚ })              â”‚          â”‚                 â”‚      â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚         Schema                     TypeScript                Input
â”‚         (Runtime)                  (Compile-time)          Validation
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Táº¡i sao dÃ¹ng Zod?**

| Lá»£i Ã­ch | MÃ´ táº£ |
|---------|-------|
| **Type-safe** | TypeScript types tá»± Ä‘á»™ng Ä‘Æ°á»£c infer tá»« schema |
| **Runtime validation** | Validate dá»¯ liá»‡u khi cháº¡y (khÃ´ng chá»‰ compile-time) |
| **Zero dependencies** | KhÃ´ng phá»¥ thuá»™c thÆ° viá»‡n khÃ¡c |
| **TÃ­ch há»£p hoÃ n háº£o** | Works great vá»›i Next.js, React Hook Form, tRPC |
| **Schema composition** | Dá»… dÃ ng káº¿t há»£p, extend, modify schemas |

---

#### 3.3.1. Primitive Types - CÃ¡c kiá»ƒu cÆ¡ báº£n

```typescript
import { z } from "zod";

// String
const nameSchema = z.string();
nameSchema.parse("Trung");        // âœ… "Trung"
nameSchema.parse(123);            // âŒ Throws error

// Number
const ageSchema = z.number();
ageSchema.parse(25);              // âœ… 25
ageSchema.parse("25");            // âŒ Throws error

// Boolean
const isActiveSchema = z.boolean();

// Date
const dateSchema = z.date();

// Literal - giÃ¡ trá»‹ cá»‘ Ä‘á»‹nh
const adminSchema = z.literal("ADMIN");
adminSchema.parse("ADMIN");       // âœ…
adminSchema.parse("USER");        // âŒ

// Enum
const roleSchema = z.enum(["ADMIN", "PM", "MEMBER"]);
```

---

#### 3.3.2. String Validators

```typescript
import { z } from "zod";

const emailSchema = z.string()
  .email("Email khÃ´ng há»£p lá»‡")
  .min(5, "Email pháº£i cÃ³ Ã­t nháº¥t 5 kÃ½ tá»±")
  .max(100, "Email khÃ´ng Ä‘Æ°á»£c quÃ¡ 100 kÃ½ tá»±");

const passwordSchema = z.string()
  .min(8, "Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±")
  .max(100)
  .regex(
    /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,
    "Máº­t kháº©u pháº£i cÃ³ chá»¯ hoa, chá»¯ thÆ°á»ng vÃ  sá»‘"
  );

const urlSchema = z.string().url("URL khÃ´ng há»£p lá»‡");
const uuidSchema = z.string().uuid("UUID khÃ´ng há»£p lá»‡");
const cuidSchema = z.string().cuid("CUID khÃ´ng há»£p lá»‡");

// CÃ¡c validators khÃ¡c
z.string().startsWith("https://");
z.string().endsWith(".com");
z.string().includes("@");
z.string().trim();                        // Loáº¡i bá» whitespace
z.string().toLowerCase();
z.string().toUpperCase();
```

---

#### 3.3.3. Number Validators

```typescript
import { z } from "zod";

const ageSchema = z.number()
  .int("Tuá»•i pháº£i lÃ  sá»‘ nguyÃªn")
  .positive("Tuá»•i pháº£i lÃ  sá»‘ dÆ°Æ¡ng")
  .min(18, "Pháº£i tá»« 18 tuá»•i trá»Ÿ lÃªn")
  .max(120, "Tuá»•i khÃ´ng há»£p lá»‡");

const priceSchema = z.number()
  .nonnegative("GiÃ¡ khÃ´ng Ä‘Æ°á»£c Ã¢m")    // >= 0
  .multipleOf(1000, "GiÃ¡ pháº£i lÃ  bá»™i sá»‘ cá»§a 1000");

// Coerce - Tá»± Ä‘á»™ng chuyá»ƒn Ä‘á»•i string thÃ nh number
const coercedNumber = z.coerce.number();
coercedNumber.parse("42");              // âœ… 42 (number)
coercedNumber.parse("abc");             // âŒ NaN â†’ Error
```

---

#### 3.3.4. Object Schema

```typescript
import { z } from "zod";

// Äá»‹nh nghÄ©a Object schema
const UserSchema = z.object({
  id: z.string().cuid(),
  name: z.string().min(2),
  email: z.string().email(),
  age: z.number().optional(),           // Optional field
  role: z.enum(["ADMIN", "PM", "MEMBER"]),
  createdAt: z.date().default(() => new Date()),
});

// â­ Infer TypeScript type tá»« schema
type User = z.infer<typeof UserSchema>;
// â†’ {
//     id: string;
//     name: string;
//     email: string;
//     age?: number | undefined;
//     role: "ADMIN" | "PM" | "MEMBER";
//     createdAt: Date;
//   }

// Sá»­ dá»¥ng
const user = UserSchema.parse({
  id: "clx123abc",
  name: "Trung",
  email: "trung@email.com",
  role: "ADMIN",
});
```

---

#### 3.3.5. Schema Modifiers

```typescript
import { z } from "zod";

// Optional - cÃ³ thá»ƒ undefined
const optionalString = z.string().optional();
// type: string | undefined

// Nullable - cÃ³ thá»ƒ null  
const nullableString = z.string().nullable();
// type: string | null

// Default - giÃ¡ trá»‹ máº·c Ä‘á»‹nh
const defaultString = z.string().default("Guest");
// parse(undefined) â†’ "Guest"

// Array
const stringArray = z.array(z.string());
const numbersArray = z.array(z.number()).min(1).max(10);

// Object utilities
const UserSchema = z.object({
  name: z.string(),
  email: z.string().email(),
  password: z.string(),
});

// Partial - táº¥t cáº£ fields thÃ nh optional
const PartialUser = UserSchema.partial();
// type: { name?: string; email?: string; password?: string }

// Pick - chá»‰ láº¥y má»™t sá»‘ fields
const LoginSchema = UserSchema.pick({ email: true, password: true });
// type: { email: string; password: string }

// Omit - loáº¡i bá» má»™t sá»‘ fields
const PublicUser = UserSchema.omit({ password: true });
// type: { name: string; email: string }

// Extend - má»Ÿ rá»™ng schema
const CreateUserSchema = UserSchema.extend({
  confirmPassword: z.string(),
});
```

---

#### 3.3.6. Transform & Refine

```typescript
import { z } from "zod";

// Transform - biáº¿n Ä‘á»•i dá»¯ liá»‡u sau khi validate
const DateFromString = z.string()
  .transform((str) => new Date(str));
// Input: string â†’ Output: Date

const SlugSchema = z.string()
  .transform((str) => str.toLowerCase().replace(/\s+/g, "-"));
// "Hello World" â†’ "hello-world"

// Refine - validation custom
const PasswordSchema = z.string()
  .min(8)
  .refine(
    (password) => /[A-Z]/.test(password),
    { message: "Pháº£i cÃ³ Ã­t nháº¥t 1 chá»¯ hoa" }
  )
  .refine(
    (password) => /[0-9]/.test(password),
    { message: "Pháº£i cÃ³ Ã­t nháº¥t 1 sá»‘" }
  );

// SuperRefine - validation object vá»›i nhiá»u fields
const RegisterSchema = z.object({
  password: z.string().min(8),
  confirmPassword: z.string(),
}).superRefine((data, ctx) => {
  if (data.password !== data.confirmPassword) {
    ctx.addIssue({
      code: z.ZodIssueCode.custom,
      message: "Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p",
      path: ["confirmPassword"],
    });
  }
});
```

---

#### 3.3.7. Validation Methods

```typescript
import { z } from "zod";

const UserSchema = z.object({
  name: z.string().min(2),
  email: z.string().email(),
});

const input = { name: "T", email: "invalid" };

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// parse() - Throws error náº¿u invalid
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
try {
  const user = UserSchema.parse(input);
} catch (error) {
  if (error instanceof z.ZodError) {
    console.log(error.errors);
  }
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// safeParse() - KhÃ´ng throw, tráº£ vá» result (KHUYáº¾N NGHá»Š)
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
const result = UserSchema.safeParse(input);

if (result.success) {
  // result.data cÃ³ type User
  console.log(result.data);
} else {
  // result.error cÃ³ type ZodError
  console.log(result.error.errors);
  // [
  //   { path: ["name"], message: "String must contain at least 2 character(s)" },
  //   { path: ["email"], message: "Invalid email" }
  // ]
}
```

---

#### 3.3.8. TÃ­ch há»£p vá»›i Server Actions

```typescript
// src/actions/user.actions.ts
"use server";

import { z } from "zod";
import { prisma } from "@/lib/prisma";

// 1. Äá»‹nh nghÄ©a Schema
const CreateUserSchema = z.object({
  name: z.string()
    .min(2, "TÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±")
    .max(50, "TÃªn khÃ´ng Ä‘Æ°á»£c quÃ¡ 50 kÃ½ tá»±"),
  email: z.string()
    .email("Email khÃ´ng há»£p lá»‡")
    .toLowerCase(),  // Tá»± Ä‘á»™ng chuyá»ƒn thÃ nh lowercase
  password: z.string()
    .min(8, "Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±"),
  role: z.enum(["ADMIN", "PM", "MEMBER"]).default("MEMBER"),
});

// 2. Infer type
type CreateUserInput = z.infer<typeof CreateUserSchema>;

// 3. Action vá»›i validation
type ActionResult<T> = 
  | { success: true; data: T }
  | { success: false; error: string; field?: string };

export async function createUser(
  input: CreateUserInput
): Promise<ActionResult<{ id: string }>> {
  // Validate vá»›i safeParse
  const validated = CreateUserSchema.safeParse(input);
  
  if (!validated.success) {
    const firstError = validated.error.errors[0];
    return {
      success: false,
      error: firstError.message,
      field: firstError.path[0] as string,
    };
  }
  
  // validated.data Ä‘Ã£ Ä‘Æ°á»£c type-safe vÃ  transform
  const user = await prisma.user.create({
    data: validated.data,
  });
  
  return { success: true, data: { id: user.id } };
}
```

---

#### 3.3.9. TÃ­ch há»£p vá»›i React Hook Form

```bash
# CÃ i Ä‘áº·t thÃªm resolver
npm install @hookform/resolvers
```

```typescript
// components/RegisterForm.tsx
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";

// Schema
const RegisterSchema = z.object({
  name: z.string().min(2, "TÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±"),
  email: z.string().email("Email khÃ´ng há»£p lá»‡"),
  password: z.string().min(8, "Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±"),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: "Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p",
  path: ["confirmPassword"],
});

type RegisterInput = z.infer<typeof RegisterSchema>;

export function RegisterForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<RegisterInput>({
    resolver: zodResolver(RegisterSchema),  // â† TÃ­ch há»£p Zod
  });
  
  async function onSubmit(data: RegisterInput) {
    // data Ä‘Ã£ Ä‘Æ°á»£c validate
    console.log(data);
  }
  
  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      <div>
        <input {...register("name")} placeholder="TÃªn" className="w-full p-2 border rounded" />
        {errors.name && <span className="text-red-500 text-sm">{errors.name.message}</span>}
      </div>
      
      <div>
        <input {...register("email")} type="email" placeholder="Email" className="w-full p-2 border rounded" />
        {errors.email && <span className="text-red-500 text-sm">{errors.email.message}</span>}
      </div>
      
      <div>
        <input {...register("password")} type="password" placeholder="Máº­t kháº©u" className="w-full p-2 border rounded" />
        {errors.password && <span className="text-red-500 text-sm">{errors.password.message}</span>}
      </div>
      
      <div>
        <input {...register("confirmPassword")} type="password" placeholder="XÃ¡c nháº­n máº­t kháº©u" className="w-full p-2 border rounded" />
        {errors.confirmPassword && <span className="text-red-500 text-sm">{errors.confirmPassword.message}</span>}
      </div>
      
      <button type="submit" disabled={isSubmitting} className="w-full bg-blue-500 text-white p-2 rounded">
        {isSubmitting ? "Äang xá»­ lÃ½..." : "ÄÄƒng kÃ½"}
      </button>
    </form>
  );
}
```

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh Zod

**BÃ i 1: Táº¡o Schema cho Project**
```typescript
// TODO: Táº¡o CreateProjectSchema vá»›i:
// - title: string, min 3, max 100
// - description: string optional
// - startDate: string transform thÃ nh Date
// - members: array of cuid, min 1 member
```

**BÃ i 2: Validation vá»›i refine**
```typescript
// TODO: Táº¡o DateRangeSchema vá»›i:
// - startDate: Date
// - endDate: Date  
// - Refine: endDate pháº£i sau startDate
```

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 1</strong></summary>

```typescript
import { z } from "zod";

const CreateProjectSchema = z.object({
  title: z.string()
    .min(3, "TiÃªu Ä‘á» pháº£i cÃ³ Ã­t nháº¥t 3 kÃ½ tá»±")
    .max(100, "TiÃªu Ä‘á» khÃ´ng Ä‘Æ°á»£c quÃ¡ 100 kÃ½ tá»±"),
  
  description: z.string().optional(),
  
  startDate: z.string()
    .transform((str) => new Date(str))
    .refine((date) => !isNaN(date.getTime()), {
      message: "NgÃ y khÃ´ng há»£p lá»‡",
    }),
  
  members: z.array(z.string().cuid())
    .min(1, "Cáº§n Ã­t nháº¥t 1 thÃ nh viÃªn"),
});

type CreateProjectInput = z.infer<typeof CreateProjectSchema>;
// {
//   title: string;
//   description?: string | undefined;
//   startDate: Date;
//   members: string[];
// }
```

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 2</strong></summary>

```typescript
import { z } from "zod";

const DateRangeSchema = z.object({
  startDate: z.coerce.date(),  // Tá»± Ä‘á»™ng chuyá»ƒn string thÃ nh Date
  endDate: z.coerce.date(),
}).refine(
  (data) => data.endDate > data.startDate,
  {
    message: "NgÃ y káº¿t thÃºc pháº£i sau ngÃ y báº¯t Ä‘áº§u",
    path: ["endDate"],  // Lá»—i sáº½ hiá»ƒn thá»‹ á»Ÿ field endDate
  }
);

// Sá»­ dá»¥ng
const result = DateRangeSchema.safeParse({
  startDate: "2024-01-15",
  endDate: "2024-01-10",  // âŒ TrÆ°á»›c startDate
});

if (!result.success) {
  console.log(result.error.errors[0].message);
  // "NgÃ y káº¿t thÃºc pháº£i sau ngÃ y báº¯t Ä‘áº§u"
}
```

</details>

---

### 3.4. Authentication & Authorization vá»›i Auth.js v5

**Authentication** (XÃ¡c thá»±c) lÃ  má»™t trong nhá»¯ng kiáº¿n thá»©c **quan trá»ng nháº¥t** cho Backend Developer. Pháº§n nÃ y sáº½ giáº£i thÃ­ch chi tiáº¿t cÃ¡c khÃ¡i niá»‡m vÃ  cÃ¡ch triá»ƒn khai trong dá»± Ã¡n NovaWork Hub.

---

#### 3.4.1. CÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n

**ğŸ” Authentication vs Authorization**

| KhÃ¡i niá»‡m | CÃ¢u há»i | VÃ­ dá»¥ |
|-----------|---------|-------|
| **Authentication** (XÃ¡c thá»±c) | "Báº¡n lÃ  ai?" | ÄÄƒng nháº­p báº±ng email/password |
| **Authorization** (PhÃ¢n quyá»n) | "Báº¡n Ä‘Æ°á»£c phÃ©p lÃ m gÃ¬?" | ADMIN cÃ³ thá»ƒ xÃ³a user, MEMBER thÃ¬ khÃ´ng |

```
              Authentication Flow
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    "TÃ´i lÃ  Trung"    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  Server  â”‚
â”‚ (Browser)â”‚                      â”‚          â”‚
â”‚          â”‚  âœ… "ÄÃºng rá»“i!"      â”‚  Kiá»ƒm traâ”‚
â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  danh tÃ­nhâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 3.4.2. Session vs Token - Hai cÃ¡ch lÆ°u tráº¡ng thÃ¡i Ä‘Äƒng nháº­p

**ğŸª Session-based Authentication**

```
              Session-based Flow
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚  1. Login (user/pass)  â”‚  Server  â”‚
â”‚          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚          â”‚
â”‚          â”‚                        â”‚  Táº¡o     â”‚
â”‚          â”‚  2. Set-Cookie:        â”‚  Session â”‚
â”‚          â”‚     sessionId=abc123   â”‚  ID lÆ°u  â”‚
â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  vÃ o DB  â”‚
â”‚          â”‚                        â”‚          â”‚
â”‚  Cookie  â”‚  3. Request kÃ¨m cookie â”‚          â”‚
â”‚  lÆ°u     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Kiá»ƒm    â”‚
â”‚  session â”‚                        â”‚  tra DB  â”‚
â”‚  ID      â”‚  4. Response           â”‚          â”‚
â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Äáº·c Ä‘iá»ƒm Session:**
- **Session ID** lÆ°u trong **cookie** cá»§a browser
- Server pháº£i **lÆ°u session vÃ o database/memory**
- PhÃ¹ há»£p vá»›i **web truyá»n thá»‘ng**
- **Auth.js sá»­ dá»¥ng cÃ¡ch nÃ y máº·c Ä‘á»‹nh**

**ğŸ« Token-based Authentication (JWT)**

```
              Token-based Flow (JWT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚  1. Login (user/pass)  â”‚  Server  â”‚
â”‚          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚          â”‚
â”‚          â”‚                        â”‚  Táº¡o JWT â”‚
â”‚          â”‚  2. Token: eyJhbGci... â”‚  (khÃ´ng  â”‚
â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  lÆ°u DB) â”‚
â”‚          â”‚                        â”‚          â”‚
â”‚  LÆ°u     â”‚  3. Request kÃ¨m token  â”‚          â”‚
â”‚  Token   â”‚     Authorization:     â”‚  Giáº£i mÃ£ â”‚
â”‚  á»Ÿ local â”‚     Bearer eyJhbGci... â”‚  Token   â”‚
â”‚          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Ä‘á»ƒ xÃ¡c  â”‚
â”‚          â”‚                        â”‚  thá»±c    â”‚
â”‚          â”‚  4. Response           â”‚          â”‚
â”‚          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Äáº·c Ä‘iá»ƒm Token:**
- Token lÆ°u á»Ÿ **client** (localStorage, cookie, memory)
- Server **khÃ´ng cáº§n lÆ°u state** (stateless)
- PhÃ¹ há»£p vá»›i **API, Mobile app, Microservices**

**So sÃ¡nh Session vs Token:**

| TiÃªu chÃ­ | Session | Token (JWT) |
|----------|---------|-------------|
| **LÆ°u trá»¯** | Server (DB/Redis) | Client (localStorage/cookie) |
| **Stateful/Stateless** | Stateful | Stateless |
| **Kháº£ nÄƒng má»Ÿ rá»™ng** | KhÃ³ (cáº§n sync session) | Dá»… (khÃ´ng cáº§n sync) |
| **Báº£o máº­t** | Tá»‘t hÆ¡n (cÃ³ thá»ƒ revoke) | KhÃ³ revoke trÆ°á»›c háº¡n |
| **PhÃ¹ há»£p vá»›i** | Web truyá»n thá»‘ng | API, Mobile, Microservices |
| **Auth.js** | âœ… Máº·c Ä‘á»‹nh | âœ… Há»— trá»£ |

---

#### 3.4.3. JWT (JSON Web Token) lÃ  gÃ¬?

JWT lÃ  má»™t **chuá»—i mÃ£ hÃ³a** chá»©a thÃ´ng tin user, cÃ³ thá»ƒ Ä‘Æ°á»£c **xÃ¡c minh** mÃ  khÃ´ng cáº§n tra cá»©u database.

**Cáº¥u trÃºc JWT:**
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IlRydW5nIn0.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
       â”‚                                      â”‚                                â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
   â”‚HEADER â”‚                           â”‚   PAYLOAD   â”‚                  â”‚   SIGNATURE   â”‚
   â”‚{      â”‚                           â”‚{            â”‚                  â”‚HMACSHA256(    â”‚
   â”‚ "alg":â”‚                           â”‚ "sub":"123",â”‚                  â”‚  header +     â”‚
   â”‚ "HS256â”‚                           â”‚ "name":"Trung"â”‚                â”‚  payload,     â”‚
   â”‚ "typ":â”‚                           â”‚ "role":"ADMIN"â”‚                â”‚  secret_key   â”‚
   â”‚ "JWT" â”‚                           â”‚ "exp":16234..â”‚                 â”‚)              â”‚
   â”‚}      â”‚                           â”‚}            â”‚                  â”‚               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Thuáº­t toÃ¡n                          Dá»¯ liá»‡u user                     Chá»¯ kÃ½ xÃ¡c thá»±c
```

**JWT Payload thÆ°á»ng chá»©a:**
```typescript
{
  "sub": "user-123",           // Subject - ID cá»§a user
  "name": "Trung Äáº·ng",        // TÃªn user
  "email": "trung@email.com",  // Email
  "role": "ADMIN",             // Vai trÃ²
  "iat": 1703500000,           // Issued At - thá»i Ä‘iá»ƒm táº¡o
  "exp": 1703586400            // Expiration - háº¿t háº¡n
}
```

---

#### 3.4.4. ÄÄƒng kÃ½ (Register)

**Flow Ä‘Äƒng kÃ½ user má»›i:**

```typescript
// src/actions/auth.actions.ts
"use server";

import { prisma } from "@/lib/prisma";
import bcrypt from "bcryptjs";
import { z } from "zod";

// 1. Schema validation
const RegisterSchema = z.object({
  email: z.string().email("Email khÃ´ng há»£p lá»‡"),
  password: z.string().min(6, "Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±"),
  name: z.string().min(2, "TÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±"),
});

export async function register(input: z.infer<typeof RegisterSchema>) {
  try {
    // 2. Validate input
    const validatedData = RegisterSchema.safeParse(input);
    if (!validatedData.success) {
      return { success: false, error: validatedData.error.errors[0].message };
    }

    const { email, password, name } = validatedData.data;

    // 3. Kiá»ƒm tra email Ä‘Ã£ tá»“n táº¡i chÆ°a
    const existingUser = await prisma.user.findUnique({ where: { email } });
    if (existingUser) {
      return { success: false, error: "Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng" };
    }

    // 4. Hash password (KHÃ”NG BAO GIá»œ lÆ°u password gá»‘c!)
    const hashedPassword = await bcrypt.hash(password, 12);
    // 12 = salt rounds - sá»‘ vÃ²ng mÃ£ hÃ³a, cÃ ng cao cÃ ng an toÃ n nhÆ°ng cháº­m hÆ¡n

    // 5. Táº¡o user trong database
    const user = await prisma.user.create({
      data: {
        email,
        name,
        password: hashedPassword,
        role: "MEMBER", // Role máº·c Ä‘á»‹nh
      },
    });

    // 6. (Optional) Gá»­i email xÃ¡c thá»±c
    // await sendVerificationEmail(user.email);

    return { success: true, userId: user.id };
  } catch (error) {
    console.error("Register error:", error);
    return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
  }
}
```

**âš ï¸ LÆ°u Ã½ quan trá»ng vá» Password:**
- **KHÃ”NG BAO GIá»œ** lÆ°u password dáº¡ng plain text
- **LUÃ”N** sá»­ dá»¥ng hashing algorithm nhÆ° **bcrypt**, **argon2**
- **Salt rounds** tá»« 10-12 lÃ  phÃ¹ há»£p cho háº§u háº¿t á»©ng dá»¥ng

---

#### 3.4.5. ÄÄƒng nháº­p thÆ°á»ng (Credentials)

**Flow Ä‘Äƒng nháº­p vá»›i email/password:**

```typescript
// src/actions/auth.actions.ts
"use server";

import { signIn } from "@/lib/auth";
import { AuthError } from "next-auth";

export async function login(email: string, password: string) {
  try {
    await signIn("credentials", {
      email,
      password,
      redirectTo: "/dashboard",
    });
    
    return { success: true };
  } catch (error) {
    if (error instanceof AuthError) {
      switch (error.type) {
        case "CredentialsSignin":
          return { success: false, error: "Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng" };
        default:
          return { success: false, error: "ÄÃ£ cÃ³ lá»—i xáº£y ra" };
      }
    }
    throw error; // Re-throw Ä‘á»ƒ Next.js xá»­ lÃ½ redirect
  }
}
```

---

#### 3.4.6. ÄÄƒng nháº­p báº±ng Google (OAuth)

**OAuth 2.0** = Cho phÃ©p Ä‘Äƒng nháº­p thÃ´ng qua bÃªn thá»© 3 (Google, Facebook, GitHub...)

```
                    OAuth Flow (ÄÄƒng nháº­p Google)
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚        â”‚  Your    â”‚        â”‚  Google  â”‚
â”‚ (Browser)â”‚        â”‚  Server  â”‚        â”‚  Server  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                   â”‚
     â”‚ 1. Click "Login   â”‚                   â”‚
     â”‚    with Google"   â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–·â”‚                   â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 2. Redirect to    â”‚                   â”‚
     â”‚    Google login   â”‚                   â”‚
     â”‚â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 3. User Ä‘Äƒng nháº­p â”‚                   â”‚
     â”‚    vÃ  cho phÃ©p    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–·â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 4. Redirect vá»    â”‚                   â”‚
     â”‚    app vá»›i code   â”‚                   â”‚
     â”‚â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 5. Gá»­i code       â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–·â”‚                   â”‚
     â”‚                   â”‚ 6. Äá»•i code láº¥y   â”‚
     â”‚                   â”‚    access token   â”‚
     â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–·â”‚
     â”‚                   â”‚                   â”‚
     â”‚                   â”‚ 7. Tráº£ vá» user    â”‚
     â”‚                   â”‚    info           â”‚
     â”‚                   â”‚â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                   â”‚                   â”‚
     â”‚ 8. Táº¡o session,   â”‚                   â”‚
     â”‚    tráº£ vá» user    â”‚                   â”‚
     â”‚â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
```

**Cáº¥u hÃ¬nh Google Provider trong Auth.js:**

```typescript
// src/lib/auth.ts
import NextAuth from "next-auth";
import Google from "next-auth/providers/google";
import Credentials from "next-auth/providers/credentials";
import { prisma } from "./prisma";
import bcrypt from "bcryptjs";

export const { handlers, signIn, signOut, auth } = NextAuth({
  providers: [
    // ğŸŒ Provider 1: Google OAuth
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    
    // ğŸ”‘ Provider 2: Email/Password
    Credentials({
      name: "credentials",
      credentials: {
        email: { label: "Email", type: "email" },
        password: { label: "Password", type: "password" },
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          return null;
        }

        const user = await prisma.user.findUnique({
          where: { email: credentials.email as string },
        });

        if (!user || !user.password) {
          return null;
        }

        const isValid = await bcrypt.compare(
          credentials.password as string,
          user.password
        );

        if (!isValid) {
          return null;
        }

        return {
          id: user.id,
          email: user.email,
          name: user.name,
          role: user.role,
        };
      },
    }),
  ],
  
  callbacks: {
    // ThÃªm thÃ´ng tin vÃ o JWT token
    async jwt({ token, user, account }) {
      if (user) {
        token.role = user.role;
      }
      
      // Xá»­ lÃ½ khi Ä‘Äƒng nháº­p báº±ng OAuth
      if (account?.provider === "google") {
        // TÃ¬m hoáº·c táº¡o user tá»« Google account
        const existingUser = await prisma.user.findUnique({
          where: { email: token.email! },
        });
        
        if (!existingUser) {
          // Táº¡o user má»›i náº¿u chÆ°a tá»“n táº¡i
          const newUser = await prisma.user.create({
            data: {
              email: token.email!,
              name: token.name!,
              avatar: token.picture,
              role: "MEMBER",
              // KhÃ´ng cáº§n password cho OAuth users
            },
          });
          token.role = newUser.role;
          token.sub = newUser.id;
        } else {
          token.role = existingUser.role;
          token.sub = existingUser.id;
        }
      }
      
      return token;
    },
    
    // ThÃªm thÃ´ng tin vÃ o session
    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.sub!;
        session.user.role = token.role as string;
      }
      return session;
    },
  },
  
  pages: {
    signIn: "/login",
    error: "/login", // Redirect vá» login náº¿u cÃ³ lá»—i
  },
});
```

**Cáº¥u hÃ¬nh Google OAuth:**

1. Truy cáº­p [Google Cloud Console](https://console.cloud.google.com/)
2. Táº¡o project má»›i hoáº·c chá»n project cÃ³ sáºµn
3. VÃ o **APIs & Services** > **Credentials**
4. Táº¡o **OAuth 2.0 Client ID**
5. ThÃªm Authorized redirect URI: `http://localhost:3000/api/auth/callback/google`
6. Copy `Client ID` vÃ  `Client Secret` vÃ o file `.env`:

```env
# .env.local
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
```

---

#### 3.4.7. Middleware báº£o vá»‡ Routes

```typescript
// src/middleware.ts
import { auth } from "@/lib/auth";
import { NextResponse } from "next/server";

export default auth((req) => {
  const { nextUrl } = req;
  const isLoggedIn = !!req.auth;
  const userRole = req.auth?.user?.role;

  // Routes cÃ´ng khai - ai cÅ©ng truy cáº­p Ä‘Æ°á»£c
  const publicRoutes = ["/login", "/register", "/"];
  
  // Routes cáº§n Ä‘Äƒng nháº­p
  const protectedRoutes = ["/dashboard", "/projects", "/tasks"];
  
  // Routes chá»‰ dÃ nh cho admin
  const adminRoutes = ["/admin"];

  const isPublicRoute = publicRoutes.includes(nextUrl.pathname);
  const isProtectedRoute = protectedRoutes.some((route) =>
    nextUrl.pathname.startsWith(route)
  );
  const isAdminRoute = adminRoutes.some((route) =>
    nextUrl.pathname.startsWith(route)
  );

  // âŒ ChÆ°a Ä‘Äƒng nháº­p mÃ  truy cáº­p protected route
  if (!isLoggedIn && isProtectedRoute) {
    return NextResponse.redirect(new URL("/login", nextUrl));
  }

  // âŒ KhÃ´ng pháº£i admin mÃ  truy cáº­p admin route
  if (isAdminRoute && userRole !== "ADMIN") {
    return NextResponse.redirect(new URL("/dashboard", nextUrl));
  }

  // âœ… Cho phÃ©p truy cáº­p
  return NextResponse.next();
});

export const config = {
  matcher: ["/((?!api|_next/static|_next/image|favicon.ico).*)"],
};
```

---

#### 3.4.8. Sá»­ dá»¥ng Session trong Components

**Trong Server Component:**
```typescript
// app/dashboard/page.tsx
import { auth } from "@/lib/auth";
import { redirect } from "next/navigation";

export default async function DashboardPage() {
  const session = await auth();
  
  if (!session) {
    redirect("/login");
  }
  
  return (
    <div>
      <h1>Welcome, {session.user.name}!</h1>
      <p>Role: {session.user.role}</p>
    </div>
  );
}
```

**Trong Client Component:**
```typescript
// components/UserMenu.tsx
"use client";

import { useSession, signOut } from "next-auth/react";

export function UserMenu() {
  const { data: session, status } = useSession();
  
  if (status === "loading") {
    return <div>Loading...</div>;
  }
  
  if (!session) {
    return <a href="/login">ÄÄƒng nháº­p</a>;
  }
  
  return (
    <div>
      <span>{session.user.name}</span>
      <button onClick={() => signOut()}>ÄÄƒng xuáº¥t</button>
    </div>
  );
}
```

---

#### ğŸ“ BÃ i táº­p thá»±c hÃ nh Authentication

**BÃ i 1: Implement Register Form**
```typescript
// TODO: Táº¡o form Ä‘Äƒng kÃ½ vá»›i cÃ¡c fields:
// - Email (validate format)
// - Password (validate min 6 kÃ½ tá»±)
// - Confirm Password (validate khá»›p vá»›i password)
// - Name (validate min 2 kÃ½ tá»±)
```

**BÃ i 2: Implement Role-based UI**
```typescript
// TODO: Hiá»ƒn thá»‹/áº©n cÃ¡c elements dá»±a trÃªn role:
// - ADMIN: Tháº¥y táº¥t cáº£ menu items
// - PM: KhÃ´ng tháº¥y menu "Quáº£n lÃ½ Users"
// - MEMBER: Chá»‰ tháº¥y menu "Dashboard" vÃ  "Tasks"
```

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 1</strong></summary>

```typescript
// components/RegisterForm.tsx
"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { register as registerUser } from "@/actions/auth.actions";

const RegisterSchema = z.object({
  email: z.string().email("Email khÃ´ng há»£p lá»‡"),
  password: z.string().min(6, "Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±"),
  confirmPassword: z.string(),
  name: z.string().min(2, "TÃªn pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±"),
}).refine((data) => data.password === data.confirmPassword, {
  message: "Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p",
  path: ["confirmPassword"],
});

type RegisterInput = z.infer<typeof RegisterSchema>;

export function RegisterForm() {
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<RegisterInput>({
    resolver: zodResolver(RegisterSchema),
  });

  async function onSubmit(data: RegisterInput) {
    setIsLoading(true);
    setError(null);

    const result = await registerUser({
      email: data.email,
      password: data.password,
      name: data.name,
    });

    if (!result.success) {
      setError(result.error);
    } else {
      // Redirect to login page
      window.location.href = "/login?registered=true";
    }

    setIsLoading(false);
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {error && <div className="error">{error}</div>}
      
      <input {...register("name")} placeholder="TÃªn" />
      {errors.name && <span>{errors.name.message}</span>}
      
      <input {...register("email")} type="email" placeholder="Email" />
      {errors.email && <span>{errors.email.message}</span>}
      
      <input {...register("password")} type="password" placeholder="Máº­t kháº©u" />
      {errors.password && <span>{errors.password.message}</span>}
      
      <input {...register("confirmPassword")} type="password" placeholder="XÃ¡c nháº­n máº­t kháº©u" />
      {errors.confirmPassword && <span>{errors.confirmPassword.message}</span>}
      
      <button type="submit" disabled={isLoading}>
        {isLoading ? "Äang xá»­ lÃ½..." : "ÄÄƒng kÃ½"}
      </button>
    </form>
  );
}
```

</details>

<details>
<summary><strong>ğŸ”‘ Báº¥m Ä‘á»ƒ xem lá»i giáº£i BÃ i 2</strong></summary>

```typescript
// components/Navigation.tsx
"use client";

import { useSession } from "next-auth/react";
import Link from "next/link";

type MenuItem = {
  label: string;
  href: string;
  roles: string[]; // Roles Ä‘Æ°á»£c phÃ©p truy cáº­p
};

const menuItems: MenuItem[] = [
  { label: "Dashboard", href: "/dashboard", roles: ["ADMIN", "PM", "MEMBER"] },
  { label: "Projects", href: "/projects", roles: ["ADMIN", "PM"] },
  { label: "Tasks", href: "/tasks", roles: ["ADMIN", "PM", "MEMBER"] },
  { label: "Team", href: "/team", roles: ["ADMIN", "PM"] },
  { label: "Quáº£n lÃ½ Users", href: "/admin/users", roles: ["ADMIN"] },
  { label: "CÃ i Ä‘áº·t há»‡ thá»‘ng", href: "/admin/settings", roles: ["ADMIN"] },
];

export function Navigation() {
  const { data: session } = useSession();
  const userRole = session?.user?.role || "MEMBER";

  // Lá»c menu items dá»±a trÃªn role
  const visibleMenuItems = menuItems.filter((item) =>
    item.roles.includes(userRole)
  );

  return (
    <nav>
      <ul>
        {visibleMenuItems.map((item) => (
          <li key={item.href}>
            <Link href={item.href}>{item.label}</Link>
          </li>
        ))}
      </ul>
    </nav>
  );
}

// Component Ä‘á»ƒ kiá»ƒm tra quyá»n
export function RoleGate({
  children,
  allowedRoles,
}: {
  children: React.ReactNode;
  allowedRoles: string[];
}) {
  const { data: session } = useSession();
  const userRole = session?.user?.role;

  if (!userRole || !allowedRoles.includes(userRole)) {
    return null; // KhÃ´ng hiá»ƒn thá»‹ gÃ¬
  }

  return <>{children}</>;
}

// Sá»­ dá»¥ng RoleGate
function AdminPanel() {
  return (
    <RoleGate allowedRoles={["ADMIN"]}>
      <div>Chá»‰ ADMIN má»›i tháº¥y panel nÃ y</div>
    </RoleGate>
  );
}
```

</details>

---

## 4. TÃ i nguyÃªn há»c táº­p

### ğŸ“š TÃ i liá»‡u chÃ­nh thá»©c (Miá»…n phÃ­)
| CÃ´ng nghá»‡ | Link | Ghi chÃº |
|-----------|------|---------|
| TypeScript | [typescriptlang.org/docs](https://www.typescriptlang.org/docs/) | Äá»c Handbook |
| Prisma | [prisma.io/docs](https://www.prisma.io/docs/) | Äá»c Getting Started + Concepts |
| Next.js | [nextjs.org/docs](https://nextjs.org/docs) | Focus vÃ o App Router |
| Auth.js | [authjs.dev](https://authjs.dev/) | Äá»c pháº§n Getting Started |
| Zod | [zod.dev](https://zod.dev/) | Äá»c README lÃ  Ä‘á»§ |

### ğŸ¥ Video Courses (Khuyáº¿n nghá»‹)
| KhÃ³a há»c | Ná»n táº£ng | Ná»™i dung |
|----------|----------|----------|
| **The Net Ninja - Next.js 14** | YouTube | Miá»…n phÃ­, cÆ¡ báº£n |
| **Prisma Course** | YouTube (Web Dev Simplified) | Prisma tá»« A-Z |
| **TypeScript Full Course** | YouTube (Dave Gray) | TypeScript chi tiáº¿t |

---

## ğŸ’¡ Máº¹o Ä‘á»ƒ tiáº¿n bá»™ nhanh

### 1. Há»c qua dá»± Ã¡n thá»±c táº¿
> Äá»«ng chá»‰ Ä‘á»c docs, hÃ£y code song song. Má»—i khÃ¡i niá»‡m há»c Ä‘Æ°á»£c, hÃ£y viáº¿t code thá»­ ngay.

### 2. Äá»c code cá»§a ngÆ°á»i khÃ¡c
> Clone cÃ¡c repo open-source dÃ¹ng Next.js + Prisma Ä‘á»ƒ há»c cÃ¡ch organize code.

### 3. Debug lÃ  báº¡n
> Khi gáº·p lá»—i, Ä‘á»«ng copy paste tá»« StackOverflow ngay. HÃ£y Ä‘á»c error message, hiá»ƒu nguyÃªn nhÃ¢n.

### 4. Type Safety lÃ  Æ°u tiÃªn
> Äá»«ng bao giá» dÃ¹ng `any`. Náº¿u TypeScript bÃ¡o lá»—i, hÃ£y fix type thay vÃ¬ bypass.

### 5. Commit thÆ°á»ng xuyÃªn
> Má»—i tÃ­nh nÄƒng nhá» hoÃ n thÃ nh, hÃ£y commit. Äiá»u nÃ y giÃºp báº¡n track Ä‘Æ°á»£c tiáº¿n Ä‘á»™ vÃ  rollback khi cáº§n.
